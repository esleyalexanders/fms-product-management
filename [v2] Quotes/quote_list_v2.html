<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quotes Management V2 - FMS</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../home-styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 10px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        /* Override for main content with sidebar */
        .main-content {
            background: #f9fafb;
        }
        
        .content-wrapper {
            padding: 0;
        }

        /* Tab styles */
        .tab-button {
            position: relative;
            padding: 0.75rem 1.25rem;
            font-weight: 500;
            color: #6b7280;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            cursor: pointer;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
        }
        
        .tab-button:hover {
            color: #374151;
            background: #f9fafb;
        }
        
        .tab-button.active {
            color: #2563eb;
            border-bottom-color: #2563eb;
            background: #eff6ff;
        }

        .tab-badge {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 1.5rem;
            height: 1.5rem;
            padding: 0 0.5rem;
            margin-left: 0.5rem;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: 9999px;
            background: #e5e7eb;
            color: #374151;
        }

        .tab-button.active .tab-badge {
            background: #2563eb;
            color: white;
        }

        /* Card styles */
        .quote-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 0.75rem;
            transition: all 0.2s;
        }

        .quote-card:hover {
            border-color: #2563eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .quote-card.selected {
            border-color: #2563eb;
            background: #eff6ff;
        }

        /* Financial summary panel */
        .financial-panel {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .progress-bar {
            height: 0.5rem;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 9999px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: white;
            border-radius: 9999px;
            transition: width 0.3s ease;
        }

        /* Collapsible section */
        .collapsible-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .collapsible-content.expanded {
            max-height: 500px;
        }

        /* Action button styles */
        .action-btn-primary {
            background: #2563eb;
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }

        .action-btn-primary:hover {
            background: #1d4ed8;
        }

        .action-btn-secondary {
            background: white;
            color: #374151;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            border: 1px solid #d1d5db;
            transition: all 0.2s;
            cursor: pointer;
        }

        .action-btn-secondary:hover {
            background: #f9fafb;
            border-color: #9ca3af;
        }

        .action-btn-sm {
            padding: 0.375rem 0.75rem;
            font-size: 0.813rem;
        }

        /* Bulk action bar */
        .bulk-action-bar {
            position: sticky;
            top: 0;
            z-index: 10;
            background: #1f2937;
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }

        .bulk-action-bar button {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
        }

        .bulk-action-bar button:hover {
            background: rgba(255, 255, 255, 0.3);
        }

        .bulk-action-bar button.cancel {
            background: rgba(239, 68, 68, 0.8);
        }

        .bulk-action-bar button.cancel:hover {
            background: rgba(220, 38, 38, 0.9);
        }

        /* Responsive */
        @media (max-width: 767px) {
            .quote-card {
                padding: 0.75rem;
            }
            
            .financial-panel {
                padding: 1rem;
            }

            .tab-button {
                padding: 0.5rem 0.75rem;
                font-size: 0.875rem;
            }
        }
    </style>
</head>
<body>
    <!-- Main Container -->
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-store"></i>
                    <div class="logo-text-wrapper">
                        <span class="logo-text">Sunshine Tutoring</span>
                    </div>
                </div>
            </div>

            <div class="sidebar-nav">
                <div class="nav-section-label">MAIN</div>
                <a href="../home.html" class="nav-item" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-home"></i><span>Home</span>
                </a>
                <a href="quote_list_v2.html" class="nav-item active" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-file-contract"></i><span>Quotes</span>
                </a>
                <a href="../[v2] Jobs/job_list.html" class="nav-item" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-briefcase"></i><span>Jobs</span>
                </a>
                <a href="../tenant_schedule.html" class="nav-item" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-calendar-alt"></i><span>Schedule</span>
                </a>
                <a href="../manage-team/manage-team.html" class="nav-item" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-users"></i><span>Manage team</span>
                </a>
                <a href="../admin/pricebook.html" class="nav-item" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-book"></i><span>My pricebook</span>
                </a>
                <a href="../Customer Management/customer-list.html" class="nav-item" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-user-friends"></i><span>Customers</span>
                </a>
            </div>

            <div class="sidebar-footer">
                <a href="../manage-team/manage-team-roles.html" class="nav-item" style="text-decoration: none; color: inherit;">
                    <i class="fas fa-shield-alt"></i>
                    <span>Manage roles</span>
                </a>
                <div class="nav-item">
                    <i class="fas fa-question-circle"></i>
                    <span>Get Set Up</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">
            <div class="content-wrapper">
                <div class="p-6">
                    <div class="max-w-7xl mx-auto">
            
            <!-- Header -->
            <div class="flex justify-between items-start mb-6">
                <div>
                    <h1 class="text-3xl font-bold text-gray-900">Quotes Management</h1>
                    <p class="text-gray-600 mt-1">Sunshine Tutoring - Melbourne East</p>
                </div>
                <div class="flex gap-2">
                    <button 
                        id="exportBtn"
                        class="action-btn-secondary flex items-center gap-2"
                    >
                        <i class="fas fa-download"></i>
                        Export
                    </button>
                    <button 
                        id="createQuoteBtn"
                        class="action-btn-primary flex items-center gap-2"
                        onclick="window.location.href='quote_create.html'"
                    >
                        <i class="fas fa-plus"></i>
                        Create New Quote
                    </button>
                </div>
            </div>

            <!-- KPI Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                <!-- Active Quotes -->
                <div class="bg-white rounded-lg shadow-sm p-5 border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-file-alt text-blue-600 text-lg"></i>
                        </div>
                        <span class="text-xs text-green-600 font-semibold flex items-center gap-1">
                            <i class="fas fa-arrow-up"></i> <span id="activeQuotesTrend">3 from last</span>
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-1">Active Quotes</p>
                    <p class="text-3xl font-bold text-gray-900" id="activeQuotes">12</p>
                </div>

                <!-- Total Value -->
                <div class="bg-white rounded-lg shadow-sm p-5 border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-dollar-sign text-green-600 text-lg"></i>
                        </div>
                        <span class="text-xs text-green-600 font-semibold flex items-center gap-1">
                            <i class="fas fa-arrow-up"></i> <span id="totalValueTrend">15% vs last</span>
                        </span>
                    </div>
                    <p class="text-sm text-gray-600 mb-1">Total Value</p>
                    <p class="text-3xl font-bold text-gray-900" id="totalValue">$0</p>
                </div>

                <!-- Outstanding -->
                <div class="bg-white rounded-lg shadow-sm p-5 border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-exclamation-circle text-orange-600 text-lg"></i>
                        </div>
                        <span class="text-xs text-red-600 font-semibold" id="unpaidCount">0 unpaid</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-1">Outstanding</p>
                    <p class="text-3xl font-bold text-gray-900" id="outstandingAmount">$0</p>
                </div>

                <!-- This Month -->
                <div class="bg-white rounded-lg shadow-sm p-5 border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <div class="w-10 h-10 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-calendar-alt text-purple-600 text-lg"></i>
                        </div>
                        <span class="text-xs text-green-600 font-semibold" id="monthlyQuotes">+0 quotes</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-1">This Month</p>
                    <p class="text-3xl font-bold text-gray-900" id="monthlyValue">$0</p>
                </div>
            </div>

            <!-- Financial Summary Panel (Collapsible) -->
            <div class="financial-panel" id="financialPanel">
                <div class="flex items-center justify-between mb-4 cursor-pointer" onclick="toggleFinancialPanel()">
                    <div class="flex items-center gap-3">
                        <i class="fas fa-chart-line text-2xl"></i>
                        <div>
                            <h3 class="text-lg font-bold">Financial Summary</h3>
                            <p class="text-sm opacity-90">Track invoicing and payment progress</p>
                        </div>
                    </div>
                    <button class="text-white hover:bg-white/20 rounded-lg p-2 transition">
                        <i class="fas fa-chevron-down" id="financialPanelIcon"></i>
                    </button>
                </div>

                <div class="collapsible-content" id="financialPanelContent">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-4">
                        <!-- Invoiced Progress -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium">Invoiced</span>
                                <span class="text-lg font-bold" id="invoicedPercent">0%</span>
                            </div>
                            <div class="progress-bar mb-2">
                                <div class="progress-fill" id="invoicedBar" style="width: 0%"></div>
                            </div>
                            <p class="text-xs opacity-75" id="invoicedAmount">$0 of $0</p>
                        </div>

                        <!-- Paid Progress -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium">Paid</span>
                                <span class="text-lg font-bold" id="paidPercent">0%</span>
                            </div>
                            <div class="progress-bar mb-2">
                                <div class="progress-fill" id="paidBar" style="width: 0%"></div>
                            </div>
                            <p class="text-xs opacity-75" id="paidAmount">$0 of $0</p>
                        </div>

                        <!-- Outstanding -->
                        <div>
                            <div class="flex justify-between items-center mb-2">
                                <span class="text-sm font-medium">Outstanding</span>
                                <span class="text-lg font-bold" id="outstandingTotal">$0</span>
                            </div>
                            <div class="mt-4">
                                <button class="bg-white/20 hover:bg-white/30 text-white px-4 py-2 rounded-lg text-sm font-medium transition">
                                    <i class="fas fa-chart-bar mr-2"></i>View Details
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Tabs -->
            <div class="bg-white rounded-lg shadow-sm mb-4 border border-gray-200">
                <div class="flex overflow-x-auto custom-scrollbar">
                    <button class="tab-button active" data-status="all" onclick="filterByStatus('all')">
                        All
                        <span class="tab-badge" id="countAll">0</span>
                    </button>
                    <button class="tab-button" data-status="draft" onclick="filterByStatus('draft')">
                        üìù Draft
                        <span class="tab-badge" id="countDraft">0</span>
                    </button>
                    <button class="tab-button" data-status="sent" onclick="filterByStatus('sent')">
                        üì§ Sent
                        <span class="tab-badge" id="countSent">0</span>
                    </button>
                    <button class="tab-button" data-status="accepted" onclick="filterByStatus('accepted')">
                        ‚úÖ Accepted
                        <span class="tab-badge" id="countAccepted">0</span>
                    </button>
                    <button class="tab-button" data-status="declined" onclick="filterByStatus('declined')">
                        ‚ùå Declined
                        <span class="tab-badge" id="countDeclined">0</span>
                    </button>
                    <button class="tab-button" data-status="converted" onclick="filterByStatus('converted')">
                        üí∞ Converted
                        <span class="tab-badge" id="countConverted">0</span>
                    </button>
                </div>
            </div>

            <!-- Search & Filters -->
            <div class="bg-white rounded-lg shadow-sm p-4 mb-4 border border-gray-200">
                <div class="flex flex-wrap gap-3 items-center">
                    <!-- Search -->
                    <div class="flex-1 min-w-64 relative">
                        <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
                        <input
                            type="text"
                            id="searchInput"
                            placeholder="Search by customer, email, or quote ID..."
                            class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm"
                        />
                    </div>

                    <!-- More Filters Toggle -->
                    <button 
                        id="toggleFiltersBtn"
                        class="action-btn-secondary flex items-center gap-2"
                        onclick="toggleFilters()"
                    >
                        <i class="fas fa-filter"></i>
                        More Filters
                        <i class="fas fa-chevron-down text-xs" id="filterIcon"></i>
                    </button>

                    <!-- Sort -->
                    <select 
                        id="sortBy"
                        class="px-4 py-2.5 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                    >
                        <option value="newest">Newest First</option>
                        <option value="oldest">Oldest First</option>
                        <option value="amount_high">Amount: High to Low</option>
                        <option value="amount_low">Amount: Low to High</option>
                        <option value="customer">Customer A-Z</option>
                    </select>
                </div>

                <!-- Collapsible Filters -->
                <div class="collapsible-content mt-4" id="moreFilters">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-3 pt-4 border-t border-gray-200">
                        <!-- Payment Status Filter -->
                        <select 
                            id="paymentStatusFilter"
                            class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="">All Payments</option>
                            <option value="not_invoiced">‚ö™ Not Invoiced</option>
                            <option value="partially_invoiced">üîµ Partial Invoice</option>
                            <option value="invoiced_unpaid">üü† Unpaid</option>
                            <option value="partially_paid">üü° Partially Paid</option>
                            <option value="fully_paid">üü¢ Fully Paid</option>
                        </select>

                        <!-- Created By Filter -->
                        <select 
                            id="createdByFilter"
                            class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="">All Team Members</option>
                            <option value="John Smith">John Smith</option>
                            <option value="Sarah Williams">Sarah Williams</option>
                            <option value="Mike Johnson">Mike Johnson</option>
                        </select>

                        <!-- Date Range Filter -->
                        <select 
                            id="dateRangeFilter"
                            class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
                        >
                            <option value="">All Time</option>
                            <option value="7">Last 7 days</option>
                            <option value="30">Last 30 days</option>
                            <option value="90">Last 90 days</option>
                        </select>

                        <!-- Clear Filters -->
                        <button 
                            id="clearFiltersBtn"
                            class="action-btn-secondary"
                            onclick="clearFilters()"
                        >
                            <i class="fas fa-times mr-2"></i>
                            Clear Filters
                        </button>
                    </div>
                </div>
            </div>

            <!-- Bulk Action Bar (Hidden by default) -->
            <div class="bulk-action-bar hidden" id="bulkActionBar">
                <input type="checkbox" id="selectAllCheckbox" class="w-5 h-5 rounded border-gray-300" onchange="toggleSelectAll()">
                <span class="font-semibold" id="selectedCount">0 selected</span>
                <div class="flex gap-2 ml-auto">
                    <button onclick="bulkSend()">
                        <i class="fas fa-paper-plane mr-2"></i>Send All
                    </button>
                    <button onclick="bulkExport()">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                    <button onclick="bulkArchive()">
                        <i class="fas fa-archive mr-2"></i>Archive
                    </button>
                    <button class="cancel" onclick="clearSelection()">
                        <i class="fas fa-times mr-2"></i>Cancel
                    </button>
                </div>
            </div>

            <!-- Quote Cards List -->
            <div id="quotesContainer">
                <!-- Cards will be rendered here by JavaScript -->
            </div>

            <!-- Empty State -->
            <div id="emptyState" class="hidden bg-white rounded-lg shadow-sm p-12 text-center border border-gray-200">
                <div class="w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-file-alt text-gray-400 text-3xl"></i>
                </div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">No quotes found</h3>
                <p class="text-gray-600 mb-6" id="emptyStateMessage">Try adjusting your filters or create a new quote</p>
                <button 
                    onclick="window.location.href='quote_create.html'"
                    class="action-btn-primary"
                >
                    <i class="fas fa-plus mr-2"></i>
                    Create Your First Quote
                </button>
            </div>

            <!-- Pagination -->
            <div id="pagination" class="hidden mt-6 flex items-center justify-between">
                <div class="text-sm text-gray-600">
                    Showing <span id="paginationStart">1</span> to <span id="paginationEnd">10</span> of <span id="paginationTotal">0</span> quotes
                </div>
                <div class="flex gap-2">
                    <button 
                        id="prevBtn"
                        class="action-btn-secondary disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        <i class="fas fa-chevron-left mr-2"></i>Previous
                    </button>
                    <button 
                        id="nextBtn"
                        class="action-btn-secondary disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                        Next<i class="fas fa-chevron-right ml-2"></i>
                    </button>
                </div>
            </div>

        </div>
    </div>
</main>
</div>

<script>
// State management
const state = {
    quotes: [],
    filteredQuotes: [],
    selectedQuotes: new Set(),
    currentPage: 1,
    itemsPerPage: 10,
    searchTerm: '',
    statusFilter: 'all',
    paymentStatusFilter: '',
    createdByFilter: '',
    dateRangeFilter: '',
    sortBy: 'newest'
};

// Sample data
const quotes = [
    {id: 'Q-2024-001', customerId: 2, customerName: 'Michael Chen', customerEmail: 'm.chen@email.com', customerPhone: '0423 456 789', createdBy: 'John Smith', dateCreated: '2024-10-25', validUntil: '2024-11-08', status: 'draft', total: 750.00, paymentStatus: 'not_invoiced', amountInvoiced: 0, amountPaid: 0},
    {id: 'Q-2024-002', customerId: 5, customerName: 'Lisa Anderson', customerEmail: 'lisa.a@email.com', customerPhone: '0456 789 012', createdBy: 'Sarah Williams', dateCreated: '2024-10-24', validUntil: '2024-11-07', status: 'draft', total: 1250.00, paymentStatus: 'not_invoiced', amountInvoiced: 0, amountPaid: 0},
    {id: 'Q-2024-003', customerId: 1, customerName: 'Sarah Johnson', customerEmail: 'sarah.j@email.com', customerPhone: '0412 345 678', createdBy: 'John Smith', dateCreated: '2024-10-23', validUntil: '2024-11-06', status: 'sent', total: 412.50, paymentStatus: 'not_invoiced', amountInvoiced: 0, amountPaid: 0},
    {id: 'Q-2024-004', customerId: 3, customerName: 'Emma Wilson', customerEmail: 'emma.w@email.com', customerPhone: '0434 567 890', createdBy: 'Mike Johnson', dateCreated: '2024-10-22', validUntil: '2024-11-05', status: 'sent', total: 850.50, paymentStatus: 'not_invoiced', amountInvoiced: 0, amountPaid: 0},
    {id: 'Q-2024-005', customerId: 4, customerName: 'David Brown', customerEmail: 'david.b@email.com', customerPhone: '0445 678 901', createdBy: 'Sarah Williams', dateCreated: '2024-10-21', validUntil: '2024-11-04', status: 'sent', total: 920.75, paymentStatus: 'partially_invoiced', amountInvoiced: 460.38, amountPaid: 230.19},
    {id: 'Q-2024-006', customerId: 6, customerName: 'James Taylor', customerEmail: 'james.t@email.com', customerPhone: '0467 890 123', createdBy: 'John Smith', dateCreated: '2024-10-20', validUntil: '2024-11-03', status: 'sent', total: 1580.00, paymentStatus: 'not_invoiced', amountInvoiced: 0, amountPaid: 0},
    {id: 'Q-2024-007', customerId: 1, customerName: 'Sarah Johnson', customerEmail: 'sarah.j@email.com', customerPhone: '0412 345 678', createdBy: 'Mike Johnson', dateCreated: '2024-10-19', validUntil: '2024-11-02', status: 'accepted', total: 3250.00, paymentStatus: 'partially_paid', amountInvoiced: 3250.00, amountPaid: 1625.00},
    {id: 'Q-2024-008', customerId: 7, customerName: 'Rachel Green', customerEmail: 'rachel.g@email.com', customerPhone: '0478 901 234', createdBy: 'Sarah Williams', dateCreated: '2024-10-18', validUntil: '2024-11-01', status: 'accepted', total: 2100.00, paymentStatus: 'invoiced_unpaid', amountInvoiced: 2100.00, amountPaid: 0},
    {id: 'Q-2024-009', customerId: 8, customerName: 'Tom Harris', customerEmail: 'tom.h@email.com', customerPhone: '0489 012 345', createdBy: 'John Smith', dateCreated: '2024-10-17', validUntil: '2024-10-31', status: 'accepted', total: 1750.00, paymentStatus: 'not_invoiced', amountInvoiced: 0, amountPaid: 0},
    {id: 'Q-2024-010', customerId: 9, customerName: 'Nina Patel', customerEmail: 'nina.p@email.com', customerPhone: '0490 123 456', createdBy: 'Mike Johnson', dateCreated: '2024-10-16', validUntil: '2024-10-30', status: 'declined', total: 890.00, paymentStatus: 'not_invoiced', amountInvoiced: 0, amountPaid: 0},
    {id: 'Q-2024-013', customerId: 1, customerName: 'Sarah Johnson', customerEmail: 'sarah.j@email.com', customerPhone: '0412 345 678', createdBy: 'John Smith', dateCreated: '2024-10-10', validUntil: '2024-10-24', status: 'converted', total: 2800.00, paymentStatus: 'fully_paid', amountInvoiced: 2800.00, amountPaid: 2800.00},
    {id: 'Q-2024-014', customerId: 3, customerName: 'Emma Wilson', customerEmail: 'emma.w@email.com', customerPhone: '0434 567 890', createdBy: 'Sarah Williams', dateCreated: '2024-10-08', validUntil: '2024-10-22', status: 'converted', total: 1950.00, paymentStatus: 'fully_paid', amountInvoiced: 1950.00, amountPaid: 1950.00},
    {id: 'Q-2024-015', customerId: 4, customerName: 'David Brown', customerEmail: 'david.b@email.com', customerPhone: '0445 678 901', createdBy: 'Mike Johnson', dateCreated: '2024-10-05', validUntil: '2024-10-19', status: 'converted', total: 3100.00, paymentStatus: 'partially_paid', amountInvoiced: 3100.00, amountPaid: 1550.00}
];

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    state.quotes = quotes;
    updateCounts();
    updateFinancialSummary();
    filterAndRender();
    setupEventListeners();
});

// Get status badge HTML
function getStatusBadge(status) {
    const badges = {
        draft: '<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700">üìù Draft</span>',
        sent: '<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700">üì§ Sent</span>',
        accepted: '<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">‚úÖ Accepted</span>',
        declined: '<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-red-100 text-red-700">‚ùå Declined</span>',
        converted: '<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700">üí∞ Converted</span>'
    };
    return badges[status] || badges.draft;
}

// Get payment status badge HTML
function getPaymentStatusBadge(paymentStatus, amountInvoiced, amountPaid, total) {
    const percentage = total > 0 ? Math.round((amountPaid / total) * 100) : 0;
    const badges = {
        not_invoiced: '<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-700">‚ö™ Not Invoiced</span>',
        partially_invoiced: `<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-700" title="$${amountInvoiced.toFixed(2)} invoiced of $${total.toFixed(2)}">üîµ Partial Invoice</span>`,
        invoiced_unpaid: `<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-700" title="$${amountInvoiced.toFixed(2)} invoiced, $0 paid">üü† Unpaid</span>`,
        partially_paid: `<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-yellow-100 text-yellow-700" title="$${amountPaid.toFixed(2)} paid of $${total.toFixed(2)} (${percentage}%)">üü° Partial (${percentage}%)</span>`,
        fully_paid: `<span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700" title="$${amountPaid.toFixed(2)} paid">üü¢ Paid</span>`
    };
    return badges[paymentStatus] || badges.not_invoiced;
}

// Get contextual actions based on status and payment
function getContextualActions(quote) {
    let actions = '';
    
    if (quote.status === 'draft') {
        actions = `<button class="action-btn-primary action-btn-sm">Send Quote</button>`;
    } else if (quote.status === 'sent') {
        actions = `<button class="action-btn-primary action-btn-sm">Follow Up</button>`;
    } else if (quote.status === 'accepted') {
        if (quote.paymentStatus === 'not_invoiced') {
            actions = `<button class="action-btn-primary action-btn-sm">Create Invoice</button>`;
        } else if (quote.paymentStatus === 'invoiced_unpaid') {
            actions = `<button class="action-btn-primary action-btn-sm">Send Payment Link</button>`;
        } else if (quote.paymentStatus === 'partially_paid') {
            actions = `<button class="action-btn-primary action-btn-sm">View Payments</button>`;
        } else if (quote.paymentStatus === 'fully_paid') {
            actions = `<button class="action-btn-primary action-btn-sm">Convert to Job</button>`;
        }
    } else if (quote.status === 'converted') {
        actions = `<button class="action-btn-secondary action-btn-sm">View Job</button>`;
    }
    
    return actions + `<button class="action-btn-secondary action-btn-sm ml-2">View</button>
                     <button class="action-btn-secondary action-btn-sm ml-2">‚ãÆ</button>`;
}

// Render quote cards
function renderQuotes() {
    const container = document.getElementById('quotesContainer');
    const emptyState = document.getElementById('emptyState');
    const pagination = document.getElementById('pagination');
    
    if (state.filteredQuotes.length === 0) {
        container.innerHTML = '';
        emptyState.classList.remove('hidden');
        pagination.classList.add('hidden');
        return;
    }
    
    emptyState.classList.add('hidden');
    pagination.classList.remove('hidden');
    
    const start = (state.currentPage - 1) * state.itemsPerPage;
    const end = start + state.itemsPerPage;
    const pageQuotes = state.filteredQuotes.slice(start, end);
    
    container.innerHTML = pageQuotes.map(quote => `
        <div class="quote-card ${state.selectedQuotes.has(quote.id) ? 'selected' : ''}" data-quote-id="${quote.id}">
            <div class="flex justify-between items-start mb-2">
                <div class="flex items-center gap-3">
                    <input type="checkbox" class="w-4 h-4 rounded border-gray-300 quote-checkbox" 
                           data-quote-id="${quote.id}" 
                           ${state.selectedQuotes.has(quote.id) ? 'checked' : ''}
                           onchange="toggleQuoteSelection('${quote.id}')">
                    <div>
                        <span class="font-semibold text-blue-600">${quote.id}</span>
                        <span class="ml-2 font-medium text-gray-900">${quote.customerName}</span>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <span class="text-lg font-bold text-gray-900">$${quote.total.toFixed(2)}</span>
                    ${getStatusBadge(quote.status)}
                </div>
            </div>
            
            <div class="text-sm text-gray-600 mb-2">
                Created: ${formatDate(quote.dateCreated)} ‚Ä¢ Valid: ${formatDate(quote.validUntil)} ‚Ä¢ By: ${quote.createdBy}
            </div>
            
            <div class="flex justify-between items-center">
                <div>
                    ${getPaymentStatusBadge(quote.paymentStatus, quote.amountInvoiced, quote.amountPaid, quote.total)}
                </div>
                <div class="flex gap-2">
                    ${getContextualActions(quote)}
                </div>
            </div>
        </div>
    `).join('');
    
    updatePagination();
}

// Format date
function formatDate(dateStr) {
    const date = new Date(dateStr);
    return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
}

// Filter and render
function filterAndRender() {
    let filtered = [...state.quotes];
    
    // Status filter
    if (state.statusFilter && state.statusFilter !== 'all') {
        filtered = filtered.filter(q => q.status === state.statusFilter);
    }
    
    // Search filter
    if (state.searchTerm) {
        const term = state.searchTerm.toLowerCase();
        filtered = filtered.filter(q => 
            q.id.toLowerCase().includes(term) ||
            q.customerName.toLowerCase().includes(term) ||
            q.customerEmail.toLowerCase().includes(term)
        );
    }
    
    // Payment status filter
    if (state.paymentStatusFilter) {
        filtered = filtered.filter(q => q.paymentStatus === state.paymentStatusFilter);
    }
    
    // Created by filter
    if (state.createdByFilter) {
        filtered = filtered.filter(q => q.createdBy === state.createdByFilter);
    }
    
    // Date range filter
    if (state.dateRangeFilter) {
        const days = parseInt(state.dateRangeFilter);
        const cutoffDate = new Date();
        cutoffDate.setDate(cutoffDate.getDate() - days);
        filtered = filtered.filter(q => new Date(q.dateCreated) >= cutoffDate);
    }
    
    // Sort
    filtered.sort((a, b) => {
        switch(state.sortBy) {
            case 'newest': return new Date(b.dateCreated) - new Date(a.dateCreated);
            case 'oldest': return new Date(a.dateCreated) - new Date(b.dateCreated);
            case 'amount_high': return b.total - a.total;
            case 'amount_low': return a.total - b.total;
            case 'customer': return a.customerName.localeCompare(b.customerName);
            default: return 0;
        }
    });
    
    state.filteredQuotes = filtered;
    state.currentPage = 1;
    renderQuotes();
}

// Update counts
function updateCounts() {
    const counts = {
        all: state.quotes.length,
        draft: state.quotes.filter(q => q.status === 'draft').length,
        sent: state.quotes.filter(q => q.status === 'sent').length,
        accepted: state.quotes.filter(q => q.status === 'accepted').length,
        declined: state.quotes.filter(q => q.status === 'declined').length,
        converted: state.quotes.filter(q => q.status === 'converted').length
    };
    
    document.getElementById('countAll').textContent = counts.all;
    document.getElementById('countDraft').textContent = counts.draft;
    document.getElementById('countSent').textContent = counts.sent;
    document.getElementById('countAccepted').textContent = counts.accepted;
    document.getElementById('countDeclined').textContent = counts.declined;
    document.getElementById('countConverted').textContent = counts.converted;
    
    // Update KPI cards
    const totalValue = state.quotes.reduce((sum, q) => sum + q.total, 0);
    const outstanding = state.quotes.reduce((sum, q) => sum + (q.amountInvoiced - q.amountPaid), 0);
    const unpaidCount = state.quotes.filter(q => q.paymentStatus === 'invoiced_unpaid' || q.paymentStatus === 'partially_paid').length;
    
    document.getElementById('activeQuotes').textContent = counts.all;
    document.getElementById('totalValue').textContent = `$${(totalValue / 1000).toFixed(1)}K`;
    document.getElementById('outstandingAmount').textContent = `$${(outstanding / 1000).toFixed(1)}K`;
    document.getElementById('unpaidCount').textContent = `${unpaidCount} unpaid`;
    
    // This month (last 30 days)
    const thirtyDaysAgo = new Date();
    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
    const monthlyQuotes = state.quotes.filter(q => new Date(q.dateCreated) >= thirtyDaysAgo);
    const monthlyValue = monthlyQuotes.reduce((sum, q) => sum + q.total, 0);
    document.getElementById('monthlyValue').textContent = `$${(monthlyValue / 1000).toFixed(1)}K`;
    document.getElementById('monthlyQuotes').textContent = `+${monthlyQuotes.length} quotes`;
}

// Update financial summary
function updateFinancialSummary() {
    const total = state.quotes.reduce((sum, q) => sum + q.total, 0);
    const invoiced = state.quotes.reduce((sum, q) => sum + q.amountInvoiced, 0);
    const paid = state.quotes.reduce((sum, q) => sum + q.amountPaid, 0);
    const outstanding = invoiced - paid;
    
    const invoicedPercent = total > 0 ? Math.round((invoiced / total) * 100) : 0;
    const paidPercent = total > 0 ? Math.round((paid / total) * 100) : 0;
    
    document.getElementById('invoicedPercent').textContent = `${invoicedPercent}%`;
    document.getElementById('invoicedBar').style.width = `${invoicedPercent}%`;
    document.getElementById('invoicedAmount').textContent = `$${invoiced.toFixed(0)} of $${total.toFixed(0)}`;
    
    document.getElementById('paidPercent').textContent = `${paidPercent}%`;
    document.getElementById('paidBar').style.width = `${paidPercent}%`;
    document.getElementById('paidAmount').textContent = `$${paid.toFixed(0)} of $${total.toFixed(0)}`;
    
    document.getElementById('outstandingTotal').textContent = `$${outstanding.toFixed(0)}`;
}

// Update pagination
function updatePagination() {
    const total = state.filteredQuotes.length;
    const start = (state.currentPage - 1) * state.itemsPerPage + 1;
    const end = Math.min(start + state.itemsPerPage - 1, total);
    
    document.getElementById('paginationStart').textContent = start;
    document.getElementById('paginationEnd').textContent = end;
    document.getElementById('paginationTotal').textContent = total;
    
    document.getElementById('prevBtn').disabled = state.currentPage === 1;
    document.getElementById('nextBtn').disabled = end >= total;
}

// Filter by status (tab click)
function filterByStatus(status) {
    state.statusFilter = status;
    
    // Update active tab
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.status === status) {
            btn.classList.add('active');
        }
    });
    
    filterAndRender();
}

// Toggle financial panel
function toggleFinancialPanel() {
    const content = document.getElementById('financialPanelContent');
    const icon = document.getElementById('financialPanelIcon');
    
    content.classList.toggle('expanded');
    icon.classList.toggle('fa-chevron-down');
    icon.classList.toggle('fa-chevron-up');
}

// Toggle filters
function toggleFilters() {
    const filters = document.getElementById('moreFilters');
    const icon = document.getElementById('filterIcon');
    
    filters.classList.toggle('expanded');
    icon.classList.toggle('fa-chevron-down');
    icon.classList.toggle('fa-chevron-up');
}

// Clear filters
function clearFilters() {
    document.getElementById('searchInput').value = '';
    document.getElementById('paymentStatusFilter').value = '';
    document.getElementById('createdByFilter').value = '';
    document.getElementById('dateRangeFilter').value = '';
    document.getElementById('sortBy').value = 'newest';
    
    state.searchTerm = '';
    state.paymentStatusFilter = '';
    state.createdByFilter = '';
    state.dateRangeFilter = '';
    state.sortBy = 'newest';
    
    filterAndRender();
}

// Toggle quote selection
function toggleQuoteSelection(quoteId) {
    if (state.selectedQuotes.has(quoteId)) {
        state.selectedQuotes.delete(quoteId);
    } else {
        state.selectedQuotes.add(quoteId);
    }
    updateBulkActionBar();
    renderQuotes();
}

// Toggle select all
function toggleSelectAll() {
    const selectAll = document.getElementById('selectAllCheckbox').checked;
    
    if (selectAll) {
        state.filteredQuotes.forEach(q => state.selectedQuotes.add(q.id));
    } else {
        state.selectedQuotes.clear();
    }
    
    updateBulkActionBar();
    renderQuotes();
}

// Update bulk action bar
function updateBulkActionBar() {
    const bar = document.getElementById('bulkActionBar');
    const count = state.selectedQuotes.size;
    
    if (count > 0) {
        bar.classList.remove('hidden');
        document.getElementById('selectedCount').textContent = `${count} selected`;
    } else {
        bar.classList.add('hidden');
    }
}

// Clear selection
function clearSelection() {
    state.selectedQuotes.clear();
    document.getElementById('selectAllCheckbox').checked = false;
    updateBulkActionBar();
    renderQuotes();
}

// Bulk actions (placeholders)
function bulkSend() { alert('Bulk send functionality'); }
function bulkExport() { alert('Bulk export functionality'); }
function bulkArchive() { alert('Bulk archive functionality'); }

// Setup event listeners
function setupEventListeners() {
    document.getElementById('searchInput').addEventListener('input', (e) => {
        state.searchTerm = e.target.value;
        filterAndRender();
    });
    
    document.getElementById('sortBy').addEventListener('change', (e) => {
        state.sortBy = e.target.value;
        filterAndRender();
    });
    
    document.getElementById('paymentStatusFilter').addEventListener('change', (e) => {
        state.paymentStatusFilter = e.target.value;
        filterAndRender();
    });
    
    document.getElementById('createdByFilter').addEventListener('change', (e) => {
        state.createdByFilter = e.target.value;
        filterAndRender();
    });
    
    document.getElementById('dateRangeFilter').addEventListener('change', (e) => {
        state.dateRangeFilter = e.target.value;
        filterAndRender();
    });
    
    document.getElementById('prevBtn').addEventListener('click', () => {
        if (state.currentPage > 1) {
            state.currentPage--;
            renderQuotes();
        }
    });
    
    document.getElementById('nextBtn').addEventListener('click', () => {
        const maxPage = Math.ceil(state.filteredQuotes.length / state.itemsPerPage);
        if (state.currentPage < maxPage) {
            state.currentPage++;
            renderQuotes();
        }
    });
}
</script>

</body>
</html>