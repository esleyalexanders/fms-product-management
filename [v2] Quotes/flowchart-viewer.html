<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FMS Flowchart Viewer</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            color: white;
            margin-bottom: 3rem;
        }

        h1 {
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .nav-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            justify-content: center;
        }

        .tab-button {
            background: white;
            border: none;
            padding: 1rem 2rem;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .tab-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.15);
        }

        .tab-button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .flowchart-section {
            display: none;
            background: white;
            border-radius: 15px;
            padding: 2rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 0.3s ease;
        }

        .flowchart-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .flowchart-title {
            font-size: 1.8rem;
            color: #333;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 3px solid #667eea;
        }

        .flowchart-content {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 400px;
            overflow-x: auto;
        }

        .mermaid {
            background: white;
            padding: 1rem;
            border-radius: 8px;
        }

        .description {
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            border-left: 4px solid #667eea;
        }

        .description h3 {
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .description p {
            color: #666;
            line-height: 1.6;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
            }

            .tab-button {
                padding: 0.75rem 1.5rem;
                font-size: 0.9rem;
            }

            .flowchart-section {
                padding: 1rem;
            }

            .flowchart-title {
                font-size: 1.4rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ”„ FMS System Flowcharts</h1>
            <p class="subtitle">Visual representation of all system flows and lifecycles</p>
        </header>

        <div class="nav-tabs">
            <button class="tab-button active" onclick="showFlow('flow1')">
                ðŸ’° Financial Flow
            </button>
            <button class="tab-button" onclick="showFlow('flow2')">
                ðŸ“‹ Quote Operation Status
            </button>
            <button class="tab-button" onclick="showFlow('flow3')">
                ðŸ’µ Quote Financial Status
            </button>
            <button class="tab-button" onclick="showFlow('flow4')">
                ðŸ”§ Job Status Lifecycle
            </button>
        </div>

        <!-- Flow 1: Financial Flow -->
        <div id="flow1" class="flowchart-section active">
            <h2 class="flowchart-title">Flow 2 (Enhanced): Financial Flow (One-Time vs Subscription)</h2>
            <div class="description">
                <h3>Overview</h3>
                <p>This flow illustrates how the system handles two distinct financial scenarios: one-time service payments and recurring subscription billing. It shows the complete journey from invoice creation to payment completion, including automated charging for subscriptions and manual payment links for one-time services.</p>
            </div>
            <div class="flowchart-content">
                <div class="mermaid">
graph TD
    subgraph Legend["Legend"]
        direction LR
        L2[System Process]
        L3((Start / End))
        L4[Auto System]
        L5[/User Action/]
        L6[Status]
    end
    
    style L2 fill:#ECECFF,stroke:#9370DB
    style L3 fill:#f9f,stroke:#333,stroke-width:2px
    style L4 fill:#FFD700,stroke:#B8860B
    style L5 fill:#DAE8FC,stroke:#6C8EBF
    style L6 fill:#D5E8D4,stroke:#82B366
    
    subgraph Flow["Flow 2 (Enhanced): Financial Flow (One-Time vs Subscription)"]
        Start((Start Financial Event)) --> Trigger{Event Type?}
        
        Trigger -->|1. One-Time Service| CreateInv[/User Clicks Create Invoice on Quote/]
        CreateInv --> SelectItems[/User SELECTS line items to invoice<br/>e.g., Down payment, Progress billing/]
        SelectItems --> InvA[System Creates Invoice Status: UNPAID]
        InvA --> GenLink[System Creates Payment Link]
        GenLink --> SendLink[/User Manually Sends Link<br/>Email/SMS/WhatsApp/]
        SendLink --> Pay1[Customer Pays via Link]
        Pay1 --> S_Paid[Invoice Status: Paid]
        S_Paid --> CheckComplete{Quote 100% invoiced & paid?}
        CheckComplete -->|No| Loop1((Waiting to invoice<br/>remaining items))
        CheckComplete -->|Yes| End1((Quote Fully Paid))
        Loop1 --> CreateInv
        
        Trigger -->|2. Subscription Cycle| Scheduler[System Scheduler Triggers<br/>e.g., 1st day of month]
        Scheduler --> CardOnFile{Customer has saved<br/>Credit Card/Account?}
        
        CardOnFile -->|Yes 99% Case| AutoCharge[System AUTO-CHARGES<br/>Stripe/PayPal Auto-Charge]
        AutoCharge --> ChargeOK{Charge Successful?}
        ChargeOK -->|Yes| AutoInvPaid[System Creates Invoice Status: PAID<br/>and Sends Receipt]
        AutoInvPaid --> Loop2((Wait for next cycle))
        Loop2 --> Scheduler
        
        ChargeOK -->|No Card Error| Dunning[Start Dunning Process<br/>Send emails, retry...]
        Dunning --> EndFail((Pause Subscription))
        
        CardOnFile -->|No Rare Case| AutoInvUnpaid[System Auto-Creates<br/>Invoice Status: UNPAID]
        AutoInvUnpaid --> GenLink2[System Creates Payment Link]
        GenLink2 --> SendLink2[System Auto-Sends Link<br/>e.g., Email invoice]
        SendLink2 --> Pay1
    end
    
    style CreateInv fill:#DAE8FC,stroke:#6C8EBF
    style SelectItems fill:#DAE8FC,stroke:#6C8EBF
    style SendLink fill:#DAE8FC,stroke:#6C8EBF
    
    style InvA fill:#ECECFF,stroke:#9370DB
    style GenLink fill:#ECECFF,stroke:#9370DB
    style Pay1 fill:#ECECFF,stroke:#9370DB
    style GenLink2 fill:#ECECFF,stroke:#9370DB
    
    style Scheduler fill:#FFD700,stroke:#B8860B
    style AutoCharge fill:#FFD700,stroke:#B8860B
    style AutoInvPaid fill:#FFD700,stroke:#B8860B
    style Dunning fill:#FFD700,stroke:#B8860B
    style AutoInvUnpaid fill:#FFD700,stroke:#B8860B
    style SendLink2 fill:#FFD700,stroke:#B8860B
    
    style S_Paid fill:#D5E8D4,stroke:#82B366
                </div>
            </div>
        </div>

        <!-- Flow 2: Quote Operation Status -->
        <div id="flow2" class="flowchart-section">
            <h2 class="flowchart-title">Quote Operation Status Lifecycle</h2>
            <div class="description">
                <h3>Overview</h3>
                <p>This lifecycle diagram tracks the operational status of a quote from creation through to completion. It shows how quotes move through various states including Draft, Sent, Accepted, Rejected, Expired, and Canceled, with transitions based on user actions and customer responses.</p>
            </div>
            <div class="flowchart-content">
                <div class="mermaid">
graph TB
    subgraph Legend["Legend"]
        L1[Active States]
        L2[Customer Decision States]
        L3[Terminal States]
    end
    
    style L1 fill:#E3F2FD,stroke:#1565C0
    style L2 fill:#FFF9C4,stroke:#F57F17
    style L3 fill:#FFCDD2,stroke:#C62828
    
    subgraph Flow["Quote Lifecycle"]
        Start([New Quote]) --> Draft[Status: Draft<br/>Being prepared]
        
        Draft -->|User sends quote| Sent[Status: Sent<br/>Awaiting customer response]
        
        Sent -->|User recalls/edits| Draft
        
        Sent -->|Customer accepts| Accepted[Status: Accepted<br/>Approved by customer]
        Sent -->|Customer rejects| Rejected[Status: Rejected<br/>Declined by customer]
        Sent -->|Time expires| Expired[Status: Expired<br/>Auto-expired by system]
        
        Rejected -->|User edits & resends| Draft
        
        Accepted -->|User cancels| Canceled[Status: Canceled<br/>Canceled after acceptance]
        
        Expired --> End1([Quote Closed])
        Canceled --> End1
    end
    
    style Start fill:#4CAF50,stroke:#2E7D32,stroke-width:3px
    style Draft fill:#E3F2FD,stroke:#1565C0,stroke-width:2px
    style Sent fill:#E3F2FD,stroke:#1565C0,stroke-width:2px
    style Accepted fill:#FFF9C4,stroke:#F57F17,stroke-width:2px
    style Rejected fill:#FFF9C4,stroke:#F57F17,stroke-width:2px
    style Expired fill:#FFCDD2,stroke:#C62828,stroke-width:2px
    style Canceled fill:#FFCDD2,stroke:#C62828,stroke-width:2px
    style End1 fill:#757575,stroke:#424242,stroke-width:3px
                </div>
            </div>
        </div>

        <!-- Flow 3: Quote Financial Status -->
        <div id="flow3" class="flowchart-section">
            <h2 class="flowchart-title">Quote Financial Status Lifecycle</h2>
            <div class="description">
                <h3>Overview</h3>
                <p>This diagram focuses on the financial progression of a quote, tracking its journey from "Not Invoiced" through various invoicing and payment states until it reaches "Paid". It illustrates partial invoicing, partial payments, and the different paths a quote can take to reach full payment.</p>
            </div>
            <div class="flowchart-content">
                <div class="mermaid">
flowchart TB
 subgraph Legend["Legend"]
        L1["Initial State"]
        L2["Invoicing States"]
        L3["Payment States"]
        L4["Final State"]
  end
 subgraph Flow["Quote Status Lifecycle"]
        Start(["Status: Not Invoiced<br>Initial State"])
        PI["Status: Partially Invoiced<br>Some items billed"]
        FI["Status: Fully Invoiced<br>All items billed"]
        PP1["Status: Partially Paid<br>Some invoices paid"]
        PP2["Status: Partially Paid<br>Some amounts paid"]
        End(["Status: Paid<br>Complete"])
  end
    Start -- Invoice some items --> PI
    Start -- Invoice all items --> FI
    PI -- Invoice remaining items --> FI
    PI -- Customer pays first invoice --> PP1
    FI -- Customer pays partially<br>Split payment --> PP2
    PP1 -- Customer pays<br>final amount --> End
    PP2 -- Customer pays<br>final amount --> End
    FI -- Customer pays<br>100% at once --> End
    Start -. Direct path<br>rare .-> End

    style L1 fill:#E1F5FF,stroke:#01579B
    style L2 fill:#FFF9C4,stroke:#F57F17
    style L3 fill:#F3E5F5,stroke:#4A148C
    style L4 fill:#C8E6C9,stroke:#1B5E20
    style Start fill:#E1F5FF,stroke:#01579B,stroke-width:3px
    style PI fill:#FFF9C4,stroke:#F57F17,stroke-width:2px
    style FI fill:#FFF9C4,stroke:#F57F17,stroke-width:2px
    style PP1 fill:#F3E5F5,stroke:#4A148C,stroke-width:2px
    style PP2 fill:#F3E5F5,stroke:#4A148C,stroke-width:2px
    style End fill:#C8E6C9,stroke:#1B5E20,stroke-width:3px
                </div>
            </div>
        </div>

        <!-- Flow 4: Job Status Lifecycle -->
        <div id="flow4" class="flowchart-section">
            <h2 class="flowchart-title">Job Status Lifecycle</h2>
            <div class="description">
                <h3>Overview</h3>
                <p>This state diagram shows the complete lifecycle of a job from creation to completion. It includes job creation triggers (manual from quotes or automatic from subscriptions), scheduling, execution states, and how jobs can be paused, resumed, or canceled. For subscription-based jobs, the diagram also shows the recurring loop back to create new job cycles.</p>
            </div>
            <div class="flowchart-content">
                <div class="mermaid">
stateDiagram-v2
    direction LR
    
    Unscheduled: Unscheduled
    Scheduled: Scheduled
    In_Progress: In Progress
    On_Hold: On Hold
    Completed: Completed
    Canceled: Canceled
    
    state "Job Creation Triggers" as Triggers {
        direction TB
        Trigger1: From Quote Manual
        Trigger2: From Subscription Auto
        Trigger1 --> Unscheduled
        Trigger2 --> Unscheduled
    }
    
    Unscheduled --> Scheduled: Manager Assigns Date + Staff
    Scheduled --> Unscheduled: Manager Unschedules
    
    Scheduled --> In_Progress: Staff Starts Job
    
    In_Progress --> On_Hold: Staff Pauses On-site issue
    Scheduled --> On_Hold: Manager Pauses Administrative reason
    
    On_Hold --> In_Progress: Staff Resumes
    On_Hold --> Scheduled: Manager Reschedules
    
    In_Progress --> Completed: Staff Completes Job
    
    Unscheduled --> Canceled: Manager Cancels
    Scheduled --> Canceled: Manager Cancels
    On_Hold --> Canceled: Manager Cancels
    
    Completed --> CheckSub
    state CheckSub <<choice>>
    CheckSub --> EndJob: No One-Time
    CheckSub --> LoopBack: Yes Subscription
    
    state LoopBack {
        [*] --> Wait: Wait for Scheduler
        Wait --> [*]: Next Job Cycle
    }
    
    LoopBack --> Trigger2
    Canceled --> EndJob
    
    state EndJob {
        [*]
    }
                </div>
            </div>
        </div>
    </div>

    <script>
        // Initialize Mermaid
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            securityLevel: 'loose',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            }
        });

        // Tab switching functionality
        function showFlow(flowId) {
            // Hide all sections
            document.querySelectorAll('.flowchart-section').forEach(section => {
                section.classList.remove('active');
            });

            // Remove active class from all buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.classList.remove('active');
            });

            // Show selected section
            document.getElementById(flowId).classList.add('active');

            // Add active class to clicked button
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
