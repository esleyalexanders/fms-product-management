<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Timesheets - FMS</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../home-styles.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f8fafc;
        }

        /* Custom scrollbar */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 3px;
        }

        /* Status badges */
        .status-pending {
            background-color: #fef3c7;
            color: #d97706;
        }

        .status-approved {
            background-color: #d1fae5;
            color: #065f46;
        }

        .status-declined {
            background-color: #fee2e2;
            color: #991b1b;
        }

        /* List row hover */
        .list-row:hover {
            background-color: #f9fafb;
        }
    </style>
</head>

<body class="overflow-hidden">
    <div class="flex h-screen">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-store"></i>
                    <span class="logo-text">FMS System</span>
                </div>
            </div>

            <div class="sidebar-nav custom-scrollbar">
                <div class="nav-section-label">MAIN</div>
                <a href="../home.html" class="nav-item"><i class="fas fa-home"></i><span>Home</span></a>
                <a href="#" class="nav-item"><i class="fas fa-file-contract"></i><span>Quotes</span></a>
                <a href="#" class="nav-item"><i class="fas fa-file-invoice-dollar"></i><span>Invoices</span></a>

                <div class="nav-section-label">LEARNING SERVICES</div>
                <a href="#" class="nav-item"><i class="fas fa-graduation-cap"></i><span>Learning Services</span></a>
                <a href="#" class="nav-item"><i class="fas fa-calendar-day"></i><span>Sessions</span></a>

                <div class="nav-section-label">HR & PAYROLL</div>
                <a href="staff_view.html" class="nav-item active"><i class="fas fa-user-clock"></i><span>My
                        Timesheets</span></a>
                <a href="timesheet_manager_inbox.html" class="nav-item"><i class="fas fa-clock"></i><span>Timesheet
                        Manager</span></a>

                <div class="nav-section-label">MANAGEMENT</div>
                <a href="#" class="nav-item"><i class="fas fa-users"></i><span>Staff Management</span></a>
                <a href="#" class="nav-item"><i class="fas fa-cog"></i><span>Settings</span></a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto custom-scrollbar bg-slate-50">
            <div class="p-6">
                <!-- Header -->
                <div class="bg-white rounded-xl shadow-sm p-6 mb-6">
                    <div class="flex justify-between items-start">
                        <div>
                            <h1 class="text-2xl font-bold text-slate-900">My Timesheets</h1>
                            <p class="text-sm text-slate-500 mt-1" id="staff-welcome">Welcome back</p>
                        </div>
                    </div>
                </div>

                <!-- Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <!-- This Month's Earnings -->
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <div class="flex items-start justify-between">
                            <div>
                                <p class="text-xs text-slate-500 font-medium mb-1">This Month's Earnings</p>
                                <p class="text-3xl font-bold text-emerald-600" id="my-earnings">$0.00</p>
                            </div>
                            <div class="w-12 h-12 bg-emerald-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-dollar-sign text-emerald-600 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Total Hours -->
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <div class="flex items-start justify-between">
                            <div>
                                <p class="text-xs text-slate-500 font-medium mb-1">Total Hours</p>
                                <p class="text-3xl font-bold text-indigo-600" id="total-hours">0h</p>
                            </div>
                            <div class="w-12 h-12 bg-indigo-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-clock text-indigo-600 text-xl"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Pending Approval -->
                    <div class="bg-white rounded-xl shadow-sm p-5">
                        <div class="flex items-start justify-between">
                            <div>
                                <p class="text-xs text-slate-500 font-medium mb-1">Pending Approval</p>
                                <p class="text-3xl font-bold text-amber-600" id="pending-count">0</p>
                            </div>
                            <div class="w-12 h-12 bg-amber-100 rounded-lg flex items-center justify-center">
                                <i class="fas fa-hourglass-half text-amber-600 text-xl"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filters -->
                <div class="bg-white rounded-xl shadow-sm p-4 mb-6">
                    <div class="flex flex-wrap items-center gap-3">
                        <!-- Period Pills -->
                        <div class="flex gap-2">
                            <button
                                class="period-btn px-4 py-2 text-sm font-medium rounded-lg text-slate-600 hover:bg-slate-100 transition-colors"
                                data-period="week">This Week</button>
                            <button
                                class="period-btn active px-4 py-2 text-sm font-medium rounded-lg bg-indigo-600 text-white"
                                data-period="month">This Month</button>
                            <button
                                class="period-btn px-4 py-2 text-sm font-medium rounded-lg text-slate-600 hover:bg-slate-100 transition-colors"
                                data-period="year">This Year</button>
                        </div>
                    </div>
                </div>

                <!-- Data Table -->
                <div class="bg-white rounded-xl shadow-sm overflow-hidden">
                    <!-- Table Header -->
                    <div
                        class="grid grid-cols-12 gap-4 px-6 py-3 bg-slate-50 border-b border-slate-200 text-xs font-semibold text-slate-600 uppercase tracking-wide">
                        <div class="col-span-2">Date</div>
                        <div class="col-span-4">Job / Session</div>
                        <div class="col-span-2 text-right">Hours</div>
                        <div class="col-span-2 text-right">Total Pay</div>
                        <div class="col-span-2 text-center">Status</div>
                    </div>

                    <!-- Table Body -->
                    <div id="timesheet-table-body" class="divide-y divide-slate-100">
                        <!-- Rows will be inserted here -->
                    </div>

                    <!-- Empty State -->
                    <div id="empty-state" class="hidden text-center py-12">
                        <i class="fas fa-clipboard-list text-slate-300 text-5xl mb-3"></i>
                        <p class="text-slate-500">No timesheets found for this period.</p>
                    </div>

                    <!-- Loading State -->
                    <div id="loading-state" class="hidden text-center py-12">
                        <i class="fas fa-spinner fa-spin text-indigo-600 text-3xl mb-3"></i>
                        <p class="text-slate-500">Loading timesheets...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="timesheet_data_service.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Simulate Logged In User
            const CURRENT_USER_ID = 'S001';
            const user = window.timesheetService.getStaff().find(s => s.id === CURRENT_USER_ID);

            if (user) {
                document.getElementById('staff-welcome').textContent = `Welcome back, ${user.name}`;
            }

            const state = {
                period: 'month',
                startDate: '',
                endDate: '',
                staffId: CURRENT_USER_ID,
                status: 'all'
            };

            // Elements
            const tableBody = document.getElementById('timesheet-table-body');
            const earningsEl = document.getElementById('my-earnings');
            const totalHoursEl = document.getElementById('total-hours');
            const pendingCountEl = document.getElementById('pending-count');
            const periodButtons = document.querySelectorAll('.period-btn');
            const loadingState = document.getElementById('loading-state');
            const emptyState = document.getElementById('empty-state');

            init();

            function init() {
                setPeriod('month');
                setupListeners();
                render();
            }

            function setupListeners() {
                periodButtons.forEach(btn => {
                    btn.addEventListener('click', (e) => {
                        periodButtons.forEach(b => {
                            b.classList.remove('bg-indigo-600', 'text-white');
                            b.classList.add('text-slate-600', 'hover:bg-slate-100');
                        });
                        e.target.classList.remove('text-slate-600', 'hover:bg-slate-100');
                        e.target.classList.add('bg-indigo-600', 'text-white');
                        setPeriod(e.target.dataset.period);
                        render();
                    });
                });
            }

            function setPeriod(period) {
                const now = new Date();
                let start = new Date();
                let end = new Date();

                if (period === 'week') {
                    const day = now.getDay() || 7;
                    if (day !== 1) start.setHours(-24 * (day - 1));
                    end.setDate(start.getDate() + 6);
                } else if (period === 'month') {
                    start = new Date(now.getFullYear(), now.getMonth(), 1);
                    end = new Date(now.getFullYear(), now.getMonth() + 1, 0);
                } else if (period === 'year') {
                    start = new Date(now.getFullYear(), 0, 1);
                    end = new Date(now.getFullYear(), 11, 31);
                }

                state.startDate = start.toISOString().split('T')[0];
                state.endDate = end.toISOString().split('T')[0];
            }

            function render() {
                loadingState.classList.remove('hidden');
                emptyState.classList.add('hidden');
                tableBody.innerHTML = '';

                const data = window.timesheetService.filterTimesheets(state);

                // Calculate Stats
                const totalEarnings = data.reduce((sum, item) => {
                    const hours = item.finalHours !== undefined && item.finalHours !== null ? item.finalHours : item.actualHours;
                    return sum + (hours * item.hourlyRate);
                }, 0);

                const totalHours = data.reduce((sum, item) => {
                    const hours = item.finalHours !== undefined && item.finalHours !== null ? item.finalHours : item.actualHours;
                    return sum + hours;
                }, 0);

                const pendingCount = data.filter(i => i.status === 'Pending').length;

                earningsEl.textContent = formatCurrency(totalEarnings);
                totalHoursEl.textContent = `${totalHours}h`;
                pendingCountEl.textContent = pendingCount;

                if (data.length === 0) {
                    emptyState.classList.remove('hidden');
                } else {
                    emptyState.classList.add('hidden');
                    data.forEach(item => {
                        tableBody.appendChild(createRow(item));
                    });
                }

                loadingState.classList.add('hidden');
            }

            function createRow(item) {
                const div = document.createElement('div');
                div.className = 'list-row grid grid-cols-12 gap-4 px-6 py-4 items-center transition-colors';

                const hours = item.finalHours !== undefined && item.finalHours !== null ? item.finalHours : item.actualHours;
                const total = hours * item.hourlyRate;

                div.innerHTML = `
                    <div class="col-span-2 text-sm font-medium text-slate-900">${formatDate(item.date)}</div>
                    
                    <div class="col-span-4">
                        <div class="text-sm text-slate-900 font-medium">${item.jobTitle}</div>
                        <div class="text-xs text-slate-500">Est: ${item.estimatedHours}h</div>
                    </div>

                    <div class="col-span-2 text-right">
                        <div class="text-sm font-semibold text-slate-900">${hours}h</div>
                        <div class="text-xs text-slate-500">@ $${item.hourlyRate}/h</div>
                    </div>

                    <div class="col-span-2 text-right font-bold text-slate-900">
                        ${formatCurrency(total)}
                    </div>

                    <div class="col-span-2 text-center">
                        <span class="status-${item.status.toLowerCase()} px-3 py-1 text-xs font-medium rounded-full inline-block">
                            ${item.status}
                        </span>
                    </div>
                `;

                return div;
            }

            function formatCurrency(amount) {
                return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount);
            }

            function formatDate(dateStr) {
                return new Date(dateStr).toLocaleDateString('en-US', {
                    month: 'short', day: 'numeric', year: 'numeric'
                });
            }
        });
    </script>
</body>

</html>