<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Job from Quote - FMS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="job_create_from_quote_styles.css">
</head>
<body class="min-h-screen bg-gray-50">
    
    <div class="p-4">
        <div class="max-w-7xl mx-auto">
            
            <!-- Header -->
            <div class="bg-white rounded-lg shadow-sm overflow-hidden mb-4">
                <!-- Header with gradient -->
                <div class="bg-gradient-to-r from-emerald-600 to-emerald-700 px-6 py-4">
                    <div class="flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                            </div>
                            <div>
                                <h1 class="text-2xl font-bold text-white">Create Job from Quote</h1>
                                <p class="text-emerald-100 text-sm mt-0.5">Configure job details and assign staff</p>
                            </div>
                        </div>
                        <button 
                            onclick="goBackToSimpleQuote()"
                            class="px-4 py-2 bg-white bg-opacity-20 hover:bg-opacity-30 text-white rounded-lg transition-colors flex items-center gap-2 font-medium"
                        >
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
                            </svg>
                            Back to Invoice
                        </button>
                    </div>
                </div>
                
            </div>

            <!-- Quote Info (Simplified) -->
            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                <div class="flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                            <svg class="w-5 h-5 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                            </svg>
                        </div>
                        <div>
                            <p class="text-sm text-blue-600 font-medium">Creating job from quote</p>
                            <p class="font-semibold text-blue-900" id="selectedQuoteId">Q-2024-001 â€¢ Sarah Johnson â€¢ $1,650.00</p>
                        </div>
                    </div>
                    <button 
                        id="changeQuoteBtn"
                        class="px-3 py-2 text-sm text-blue-600 hover:text-blue-700 hover:bg-blue-100 rounded-lg transition-colors font-medium"
                    >
                        Change Quote
                    </button>
                </div>
            </div>

            <!-- Quote Search Modal (Hidden by default) -->
            <div id="quoteSearchModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
                <div class="bg-white rounded-lg shadow-xl max-w-2xl w-full max-h-[80vh] overflow-hidden">
                    <div class="p-6 border-b border-gray-200">
                        <div class="flex items-center justify-between">
                            <h3 class="text-lg font-semibold text-gray-900">Select Quote</h3>
                            <button id="closeQuoteModal" class="text-gray-400 hover:text-gray-600">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                                </svg>
                            </button>
                        </div>
                        <div class="mt-4">
                            <div class="relative">
                                <svg class="absolute left-3 top-3 text-gray-400 w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                                </svg>
                                <input 
                                    type="text" 
                                    id="quoteSearchInput"
                                    placeholder="Search quotes by ID, customer name..."
                                    class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                        </div>
                    </div>
                    <div class="p-6 overflow-y-auto max-h-96">
                        <div id="quoteSearchResults" class="space-y-2">
                            <!-- Search results will appear here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">
                
                <!-- Left Column - Job Configuration (8 columns) -->
                <div class="lg:col-span-8 space-y-4">
                    
                    <!-- Job Details Card -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">Job Details</h2>
                        
                        <div class="space-y-4">
                            <!-- Job Name -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Job Name</label>
                                <input 
                                    type="text" 
                                    id="jobName"
                                    placeholder="Auto-generated from quote"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                />
                            </div>
                            
                            <!-- Priority -->
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Priority</label>
                                <select id="priority" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                    <option value="medium" selected>ðŸ”µ Medium</option>
                                    <option value="high">ðŸ”´ High</option>
                                    <option value="low">ðŸŸ¢ Low</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    
                    <!-- Notes Card -->
                    <div class="bg-white rounded-lg shadow-sm p-6">
                        <h2 class="text-lg font-semibold text-gray-900 mb-4">Internal Notes</h2>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                Notes for your team <span class="text-gray-500 font-normal">(Optional)</span>
                            </label>
                            <textarea 
                                id="internalNotes"
                                rows="4"
                                placeholder="Add any special instructions or notes for the team..."
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 resize-none"
                            ></textarea>
                        </div>
                    </div>
                    
                </div>
                
                <!-- Right Column - Customer Info & Summary (4 columns) -->
                <div class="lg:col-span-4 space-y-4">
                    
                    <!-- Customer & Quote Summary -->
                    <div class="bg-white rounded-lg shadow-sm p-6 sticky top-4">
                        <h3 class="text-lg font-semibold text-gray-900 mb-4">Summary</h3>
                        
                        <div class="space-y-4">
                            <!-- Customer -->
                            <div class="p-3 bg-gray-50 rounded-lg">
                                <p class="text-xs font-medium text-gray-500 mb-1">Customer</p>
                                <p class="font-semibold text-gray-900">Sarah Johnson</p>
                                <div class="flex items-center gap-4 mt-2 text-xs text-gray-600">
                                    <a href="mailto:sarah.j@email.com" class="hover:text-blue-600">ðŸ“§ Email</a>
                                    <a href="tel:+61400123456" class="hover:text-blue-600">ðŸ“ž Call</a>
                                </div>
                            </div>
                            
                            <!-- Quote Summary -->
                            <div class="p-3 bg-emerald-50 rounded-lg">
                                <p class="text-xs font-medium text-gray-500 mb-2">Quote Summary</p>
                                <div class="space-y-1">
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">ID:</span>
                                        <span class="font-medium">Q-2024-001</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Items:</span>
                                        <span class="font-medium">5 items</span>
                                    </div>
                                    <div class="flex justify-between text-sm">
                                        <span class="text-gray-600">Total:</span>
                                        <span class="font-semibold text-emerald-600">$1,650.00</span>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="pt-2">
                                <a href="../[v2] Quotes/quote_simple/quote_edit_simple.html" class="text-sm text-blue-600 hover:text-blue-700 font-medium flex items-center gap-2">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                                    </svg>
                                    View Quote Details
                                </a>
                            </div>
                        </div>
                    </div>
                    
                </div>
                
            </div>
            
            <!-- Action Buttons -->
            <div class="flex gap-3 justify-end mt-6">
                <button 
                    id="scheduleNowBtn"
                    onclick="window.location.href='job_schedule_assign.html'"
                    class="px-6 py-3 border border-blue-600 text-blue-600 rounded-lg hover:bg-blue-50 font-medium flex items-center gap-2 transition-colors"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                    </svg>
                    Schedule Now
                </button>
                <button 
                    id="createJobBtn"
                    class="px-6 py-3 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 font-medium flex items-center gap-2 transition-colors shadow-sm"
                >
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                    </svg>
                    Create Job
                </button>
            </div>
            
        </div>
    </div>

    <script src="job_create_simple_script.js"></script>
    
    <script>
        // Navigation functions for simple quote integration
        function goBackToSimpleQuote() {
            const urlParams = new URLSearchParams(window.location.search);
            const invoiceId = urlParams.get('invoiceId');
            const quoteId = urlParams.get('quoteId');
            
            // Navigate back to the appropriate simple quote screen
            if (invoiceId) {
                window.location.href = '../[v2] Quotes/quote_simple/invoice_detail_simple.html?id=' + invoiceId;
            } else if (quoteId) {
                window.location.href = '../[v2] Quotes/quote_simple/quote_edit_simple.html?id=' + quoteId;
            } else {
                // Default fallback to invoice list
                window.location.href = '../[v2] Quotes/quote_simple/invoice_list_simple.html';
            }
        }
        
        // Update create job button to handle simple quote workflow
        document.getElementById('createJobBtn').addEventListener('click', function() {
            // Collect form data
            const jobName = document.getElementById('jobName').value || 'Job from Quote Q-2024-001';
            const priority = document.getElementById('priority').value;
            const internalNotes = document.getElementById('internalNotes').value;
            
            // Generate job ID with proper format
            const timestamp = Date.now();
            const jobId = 'JOB-2024-' + String(timestamp).slice(-6);
            
            // Create comprehensive job data
            const jobData = {
                id: jobId,
                name: jobName,
                quoteId: new URLSearchParams(window.location.search).get('quoteId') || 'Q-2024-001',
                priority: priority,
                notes: internalNotes,
                status: 'scheduled',
                createdAt: new Date().toISOString(),
                customer: {
                    name: 'Sarah Johnson',
                    email: 'sarah.j@email.com',
                    phone: '+61400123456'
                }
            };
            
            // Save job data to localStorage for the job details page
            localStorage.setItem('currentJob', JSON.stringify(jobData));
            localStorage.setItem('job_' + jobId, JSON.stringify(jobData));
            
            // Show success message and navigate to job details
            alert('Job created successfully!\n\nJob ID: ' + jobId + '\n\nRedirecting to job details...');
            
            // Navigate to job details page with the job ID
            window.location.href = 'job_detail.html?id=' + jobId;
        });
    </script>
</body>
</html>
