<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Staff Dashboard - Franchise Management System</title>
  <link rel="stylesheet" href="../home-styles.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    .content{max-width:1200px;margin:28px auto;padding:18px;background:#fff;border-radius:8px}
    .top-row{display:flex;gap:12px;align-items:center;margin-bottom:16px}
    h1{margin:0;font-size:20px}
    .card{background:#fff;padding:16px;border-radius:12px;margin-top:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
    table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
    th,td{padding:12px;text-align:left;border-bottom:1px solid #eef2f7;vertical-align:middle}
    th{color:#6b7280;font-size:13px;font-weight:600}
    .small{font-size:13px;color:#6b7280}
    .actions{display:flex;gap:8px}
    .pill{padding:6px 10px;border-radius:999px;color:#065f46;background:#ecfdf5;border:1px solid #bbf7d0;font-weight:600}
    .pill.assigned{color:#6b7280;background:#f8fafc;border:1px solid #e6eef8}
    .pill.in_progress{color:#d97706;background:#fef3c7;border:1px solid #fde68a}
    .pill.completed{color:#065f46;background:#ecfdf5;border:1px solid #bbf7d0}
    .empty{padding:32px;text-align:center;color:#6b7280}
    tr.row-hover:hover{background:#fbfdff}
    .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center}
    .modal{background:#fff;border-radius:10px;max-width:520px;width:100%;padding:16px}
    .modal h3{margin:0 0 8px}
    @media (max-width:720px){ .content{padding:12px} }
  </style>
</head>
<body>
  <div class="app-container">
    <nav class="sidebar">
      <div class="sidebar-header"><div class="logo"><i class="fas fa-store"></i><div class="logo-text-wrapper"><span class="logo-text">My Store</span></div></div></div>
      <div class="sidebar-nav">
        <div class="nav-section-label">STAFF</div>
        <a href="dashboard.html" class="nav-item active"><i class="fas fa-tachometer-alt"></i><span>Dashboard</span></a>
        <a href="../home.html" class="nav-item"><i class="fas fa-home"></i><span>Back to Home</span></a>
      </div>
    </nav>
    <main class="main-content">
      <div class="content">
        <div class="top-row">
          <div>
            <h1>My Jobs</h1>
            <div class="small">View and update assigned jobs</div>
          </div>
        </div>

        <div class="card">
          <table id="jobsTable" aria-live="polite">
            <thead>
              <tr>
                <th>Customer</th>
                <th>Service</th>
                <th>Address</th>
                <th>Status</th>
                <th>Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="jobsBody">
            </tbody>
          </table>

          <div id="emptyState" class="empty" style="display:none">No assigned jobs.</div>
        </div>
      </div>
    </main>
  </div>

  <div id="updateModal" class="modal-backdrop">
    <div class="modal">
      <h3>Update Job Status</h3>
      <p class="small">Select new status and optionally upload proof photos.</p>
      <div style="margin-top:12px">
        <label>Status:</label>
        <select id="statusSelect" style="margin-left:8px;padding:6px;border:1px solid #e5e7eb;border-radius:4px">
          <option value="assigned">Assigned</option>
          <option value="in_progress">In Progress</option>
          <option value="completed">Completed</option>
        </select>
      </div>
      <div style="margin-top:12px">
        <label>Upload Photos:</label>
        <input type="file" id="photoInput" accept="image/*" multiple style="margin-left:8px">
      </div>
      <div style="margin-top:16px"><button id="saveUpdate" class="btn btn-primary">Save</button> <button id="cancelUpdate" class="btn">Cancel</button></div>
    </div>
  </div>

  <script>
    (function(){
      const STORAGE_KEY = 'fms_jobs';
      const jobsBody = document.getElementById('jobsBody');
      const emptyState = document.getElementById('emptyState');
      const updateModal = document.getElementById('updateModal');
      const statusSelect = document.getElementById('statusSelect');
      const photoInput = document.getElementById('photoInput');
      const saveUpdate = document.getElementById('saveUpdate');
      const cancelUpdate = document.getElementById('cancelUpdate');
      let currentJobId = null;

      function read(){
        try{const raw = localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):[];}catch(e){console.error(e);return[]}
      }
      function write(v){ localStorage.setItem(STORAGE_KEY, JSON.stringify(v)); }

      function sampleJobs(){
        return [
          {id:'1',customer:'John Doe',service:'Window Cleaning',address:'123 Main St',status:'assigned',date:'2025-10-23',photos:[]},
          {id:'2',customer:'Jane Smith',service:'Oven Clean',address:'456 Elm St',status:'in_progress',date:'2025-10-22',photos:[]},
          {id:'3',customer:'Bob Johnson',service:'Carpet Clean',address:'789 Oak St',status:'completed',date:'2025-10-21',photos:[]}
        ];
      }

      function ensureSeed(){ const cur = read(); if(cur.length===0){ write(sampleJobs()); } }

      function render(){
        const jobs = read();
        jobsBody.innerHTML = '';
        if(jobs.length===0){ emptyState.style.display='block'; }
        else{ emptyState.style.display='none'; }

        jobs.forEach(job=>{
          const tr = document.createElement('tr');
          tr.className = 'row-hover';
          tr.innerHTML = `
            <td>
              <div style="font-weight:700;color:#0b1220">${escapeHtml(job.customer)}</div>
            </td>
            <td>${escapeHtml(job.service)}</td>
            <td class="small">${escapeHtml(job.address)}</td>
            <td><span class="pill ${job.status}">${job.status.replace('_',' ').charAt(0).toUpperCase()+job.status.replace('_',' ').slice(1)}</span></td>
            <td class="small">${escapeHtml(job.date)}</td>
            <td>
              <div class="actions">
                <button title="Update Status" class="btn" data-id="${job.id}" data-action="update"><i class="fas fa-edit" style="color:#374151"></i></button>
                <button title="View Photos" class="btn" data-id="${job.id}" data-action="view"><i class="fas fa-images" style="color:#10b981"></i></button>
              </div>
            </td>
          `;
          jobsBody.appendChild(tr);
        });
      }

      function escapeHtml(s){ return String(s||'').replace(/[&<>\"]+/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]||c)); }

      document.getElementById('jobsTable').addEventListener('click', (e)=>{
        const btn = e.target.closest('button'); if(!btn) return;
        const id = btn.dataset.id; const action = btn.dataset.action;
        if(action==='update'){
          currentJobId = id;
          const job = read().find(j=>j.id===id);
          if(job) statusSelect.value = job.status;
          updateModal.style.display = 'flex';
        } else if(action==='view'){
          const job = read().find(j=>j.id===id);
          if(job && job.photos.length>0){
            alert('Photos: ' + job.photos.length + ' uploaded');
          } else {
            alert('No photos uploaded');
          }
        }
      });

      saveUpdate.addEventListener('click', ()=>{
        if(!currentJobId) return;
        const list = read();
        const job = list.find(j=>j.id===currentJobId);
        if(!job) return;
        job.status = statusSelect.value;
        // Handle photos
        const files = photoInput.files;
        if(files.length>0){
          for(let file of files){
            const reader = new FileReader();
            reader.onload = function(e){
              job.photos.push(e.target.result);
              write(list);
            };
            reader.readAsDataURL(file);
          }
        }
        write(list);
        render();
        updateModal.style.display = 'none';
        photoInput.value = '';
        currentJobId = null;
      });

      cancelUpdate.addEventListener('click', ()=>{
        updateModal.style.display = 'none';
        photoInput.value = '';
        currentJobId = null;
      });

      ensureSeed(); render();
    })();
  </script>
</body>
</html>
