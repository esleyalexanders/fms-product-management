<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Pricebook - Manage Services</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{--bg:#f8fafc;--card:#fff;--muted:#6b7280;--accent:#6366f1;--danger:#ef4444;--muted-2:#9ca3af}
        *{box-sizing:border-box}
        body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;margin:0;background:var(--bg);color:#0f172a}
        .container{max-width:1100px;margin:28px auto;padding:16px}
        .top-row{display:flex;gap:12px;align-items:center}
        h1{margin:0;font-size:20px}
        .toolbar{margin-left:auto;display:flex;gap:8px}
        .btn{padding:8px 12px;border-radius:8px;border:1px solid #e6e9ee;background:var(--card);cursor:pointer;font-weight:600}
        .btn:hover{transform:translateY(-1px)}
        .btn-primary{background:var(--accent);color:#fff;border:none}
        .btn-ghost{background:transparent;border:1px solid transparent}
        .card{background:var(--card);padding:16px;border-radius:12px;margin-top:16px;box-shadow:0 6px 18px rgba(2,6,23,0.06)}
        .search{display:flex;gap:8px;align-items:center}
        input[type=text]{padding:10px 12px;border:1px solid #e5e7eb;border-radius:10px;width:320px}
        select{padding:9px;border-radius:8px;border:1px solid #e5e7eb;background:#fff}
        table{width:100%;border-collapse:collapse;margin-top:12px;font-size:14px}
        th,td{padding:12px;text-align:left;border-bottom:1px solid #eef2f7;vertical-align:middle}
        th{color:var(--muted);font-size:13px;font-weight:600}
        .small{font-size:13px;color:var(--muted)}
        .actions{display:flex;gap:8px}
        .pill{padding:6px 10px;border-radius:999px;color:#065f46;background:#ecfdf5;border:1px solid #bbf7d0;font-weight:600}
        .pill.draft{color:#6b7280;background:#f8fafc;border:1px solid #e6eef8}
        .empty{padding:32px;text-align:center;color:var(--muted)}
        .inline-img{width:56px;height:56px;border-radius:8px;object-fit:cover;border:1px solid #eee}
        tr.row-hover:hover{background:#fbfdff}
        .action-icon{background:#f1f5f9;border-radius:8px;padding:8px;display:inline-flex;align-items:center;justify-content:center}
        /* modal */
        .modal-backdrop{position:fixed;inset:0;background:rgba(2,6,23,0.45);display:none;align-items:center;justify-content:center}
        .modal{background:#fff;border-radius:10px;max-width:520px;width:100%;padding:16px}
        .modal h3{margin:0 0 8px}
        .toast{position:fixed;right:20px;bottom:20px;background:#0f172a;color:#fff;padding:10px 14px;border-radius:8px;display:none}
        @media (max-width:720px){ .container{padding:12px} input[type=text]{width:180px} .toolbar{flex-wrap:wrap} }
    </style>
    <link rel="stylesheet" href="../home-styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Sidebar (copied from home.html, adjusted links for admin folder) -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-store"></i>
                    <div class="logo-text-wrapper">
                        <span class="logo-text" id="storeName">My Store</span>
                        <button class="edit-store-btn" title="Edit store name">
                            <i class="fas fa-pencil-alt"></i>
                        </button>
                    </div>
                </div>
            </div>

            <div class="sidebar-nav">
                <div class="nav-section-label">MAIN</div>
                <a href="../home.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-home"></i><span>Home</span></a>
                <a href="../quotes.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-file-contract"></i><span>Quotes</span></a>
                <a href="../tenant_schedule.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-calendar-alt"></i><span>Schedule</span></a>
                <a href="../manage-team.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-users"></i><span>Manage team</span></a>
                <a href="pricebook.html" class="nav-item active" style="text-decoration: none; color: inherit;"><i class="fas fa-book"></i><span>My pricebook</span></a>

            <div class="sidebar-footer">
                <div class="nav-item">
                    <i class="fas fa-question-circle"></i>
                    <span>Get Set Up</span>
                </div>
                <div class="nav-item">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
    <div class="container">
        <div class="top-row">
            <div>
                <h1>My pricebook</h1>
                <div class="small">Manage services and products offered by your store</div>
            </div>
            <div class="toolbar">
                <button id="importBtn" class="btn">Import</button>
                <button id="newBtn" class="btn btn-primary">Add item</button>
            </div>
        </div>

        <div class="card">
            <div style="display:flex;align-items:center;gap:12px;justify-content:space-between;">
                <div class="search">
                    <i class="fas fa-search" style="color:var(--muted)"></i>
                    <input id="searchInput" type="text" placeholder="Search by name, code or SKU">
                    <select id="filterType" style="padding:8px;border-radius:8px;border:1px solid #e5e7eb">
                        <option value="">All types</option>
                        <option value="service">Service</option>
                        <option value="product">Product</option>
                    </select>
                </div>
                <div class="small">Showing <span id="count">0</span> items</div>
            </div>

            <table id="itemsTable" aria-live="polite">
                <thead>
                    <tr>
                        <th style="width:60px">Image</th>
                        <th>Item</th>
                        <th>SKU / Code</th>
                        <th style="width:130px">Price</th>
                        <th style="width:130px">Tax</th>
                        <th style="width:120px">Status</th>
                        <th style="width:160px">Actions</th>
                    </tr>
                </thead>
                <tbody id="itemsBody">
                </tbody>
            </table>

            <div id="emptyState" class="empty" style="display:none">No items yet. Click "Add item" to create your first service or product.</div>
        </div>
    </div>
        </main>
    </div>

    <script>
    // Simple localStorage-based demo pricebook manager
    (function(){
        const STORAGE_KEY = 'fms_pricebook';
        const itemsBody = document.getElementById('itemsBody');
        const countEl = document.getElementById('count');
        const emptyState = document.getElementById('emptyState');
        const searchInput = document.getElementById('searchInput');
        const filterType = document.getElementById('filterType');

        function read(){
            try{const raw = localStorage.getItem(STORAGE_KEY); return raw?JSON.parse(raw):[];}catch(e){console.error(e);return[]}
        }
        function write(v){ localStorage.setItem(STORAGE_KEY, JSON.stringify(v)); }

        function sampleData(){
            return [
                {id:'1',type:'service',name:'Window Cleaning',sku:'WC100',price:120.00,tax:'GST 10%',image:'',published:true},
                {id:'2',type:'service',name:'Oven Steam Clean',sku:'OSC200',price:220.00,tax:'GST 10%',image:'',published:false},
                {id:'3',type:'product',name:'Cleaning Kit',sku:'CK50',price:29.99,tax:'GST 10%',image:'',published:true}
            ];
        }

        function ensureSeed(){ const cur = read(); if(cur.length===0){ write(sampleData()); } }

        function render(){
            const q = searchInput.value.trim().toLowerCase();
            const typeFilter = filterType.value;
            const items = read().filter(it=>{
                if(typeFilter && it.type!==typeFilter) return false;
                if(!q) return true;
                return (it.name||'').toLowerCase().includes(q) || (it.sku||'').toLowerCase().includes(q) || (it.id||'').toLowerCase().includes(q);
            });
            itemsBody.innerHTML = '';
            if(items.length===0){ document.getElementById('emptyState').style.display='block'; }
            else{ document.getElementById('emptyState').style.display='none'; }

            items.forEach(it=>{
                const tr = document.createElement('tr');
                tr.className = 'row-hover';
                tr.innerHTML = `
                    <td><img src="${it.image||'https://via.placeholder.com/56?text=Img'}" class="inline-img" alt=""></td>
                    <td>
                        <div style="font-weight:700;color:#0b1220">${escapeHtml(it.name)}</div>
                        <div class="small">${it.type.charAt(0).toUpperCase()+it.type.slice(1)}</div>
                    </td>
                    <td class="small">${escapeHtml(it.sku||'')}</td>
                    <td style="font-weight:700">$${Number(it.price||0).toFixed(2)}</td>
                    <td class="small">${escapeHtml(it.tax||'')}</td>
                    <td>${it.published? '<span class="pill">Published</span>' : '<span class="pill draft">Draft</span>'}</td>
                    <td>
                        <div class="actions">
                            <button title="Toggle publish" class="btn" data-id="${it.id}" data-action="toggle">
                                <i class="fas fa-toggle-on" style="color:${it.published? '#10b981':'#9ca3af'}"></i>
                            </button>
                            <button title="Edit" class="btn" data-id="${it.id}" data-action="edit"><i class="fas fa-edit" style="color:#374151"></i></button>
                            <button title="Delete" class="btn" data-id="${it.id}" data-action="delete"><i class="fas fa-trash" style="color:var(--danger)"></i></button>
                        </div>
                    </td>
                `;
                itemsBody.appendChild(tr);
            });
            countEl.textContent = items.length;
        }

        function escapeHtml(s){ return String(s||'').replace(/[&<>\"]+/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;' }[c]||c)); }

        function findById(id){ return read().find(x=>x.id===id); }

        function saveItem(updated){
            const list = read();
            const idx = list.findIndex(x=>x.id===updated.id);
            if(idx>=0) list[idx]=updated; else list.push(updated);
            write(list);
            render();
        }

        // Actions
        // event delegation for actions with nicer confirmations and toast
        document.getElementById('itemsTable').addEventListener('click', (e)=>{
            const btn = e.target.closest('button'); if(!btn) return;
            const id = btn.dataset.id; const action = btn.dataset.action;
            if(action==='toggle'){
                const list = read(); const i = list.find(x=>x.id===id); if(!i) return;
                const willPublish = !i.published;
                const title = willPublish ? 'Publish item' : 'Unpublish item';
                const msg = willPublish ? 'Are you sure you want to publish this item? It will be visible to customers.' : 'Are you sure you want to unpublish this item? It will no longer be visible to customers.';
                openConfirm(title, msg, ()=>{
                    i.published = willPublish;
                    write(list);
                    render();
                    showToast(willPublish? 'Published' : 'Unpublished');
                });
            } else if(action==='edit'){
                // navigate to the edit page relative to the current admin folder
                location.href = 'pricebook-edit.html?id=' + encodeURIComponent(id);
            } else if(action==='delete'){
                openConfirm('Delete item', 'Are you sure you want to delete this item?', ()=>{
                    const list = read().filter(x=>x.id!==id); write(list); render(); showToast('Deleted');
                });
            }
        });

        document.getElementById('newBtn').addEventListener('click', ()=>{
            location.href = 'admin/pricebook-create.html';
        });

        // Quick import stub with toast
        document.getElementById('importBtn').addEventListener('click', ()=>{
            if(!confirm('Seed demo items into pricebook? This will append sample items.')) return;
            const cur = read(); const seed = sampleData(); write(cur.concat(seed)); render(); showToast('Demo items imported');
        });

        // Search + filter
        searchInput.addEventListener('input', render);
        filterType.addEventListener('change', render);

        // initialize
        ensureSeed(); render();

        // confirmation modal + toast
        function openConfirm(title, message, onConfirm){
            let backdrop = document.getElementById('modalBackdrop');
            if(!backdrop){
                backdrop = document.createElement('div'); backdrop.id='modalBackdrop'; backdrop.className='modal-backdrop';
                backdrop.innerHTML = `<div class="modal" role="dialog" aria-modal="true"><h3 id="modalTitle"></h3><p id="modalMsg" class="small" style="margin-bottom:16px"></p><div style="display:flex;gap:8px;justify-content:flex-end"><button id="modalCancel" class="btn">Cancel</button><button id="modalConfirm" class="btn btn-primary">Confirm</button></div></div>`;
                document.body.appendChild(backdrop);
            }
            document.getElementById('modalTitle').textContent = title;
            document.getElementById('modalMsg').textContent = message;
            backdrop.style.display = 'flex';
            function cleanup(){ backdrop.style.display='none'; document.getElementById('modalCancel').removeEventListener('click', onCancel); document.getElementById('modalConfirm').removeEventListener('click', onOk); }
            function onCancel(){ cleanup(); }
            function onOk(){ cleanup(); onConfirm && onConfirm(); }
            document.getElementById('modalCancel').addEventListener('click', onCancel);
            document.getElementById('modalConfirm').addEventListener('click', onOk);
        }

        function showToast(msg){
            let t = document.getElementById('fmsToast');
            if(!t){ t = document.createElement('div'); t.id='fmsToast'; t.className='toast'; document.body.appendChild(t); }
            t.textContent = msg; t.style.display='block'; t.style.opacity='';
            setTimeout(()=>{ t.style.display='none'; }, 1800);
        }
    })();
    </script>
</body>
</html>
