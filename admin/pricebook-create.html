<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Pricebook Item — Admin</title>
    <link rel="stylesheet" href="../add-product-styles.css">
    <link rel="stylesheet" href="../home-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
      /* small local adjustments to integrate with existing styles */
      .card{padding:14px;border-radius:8px;background:#fff;border:1px solid #eef2f6;margin-bottom:12px}
      .form-input, .form-select, .form-textarea{width:100%;padding:10px;border:1px solid #e6e9ee;border-radius:6px}
      .preview-card .preview-image img{width:100%;height:auto;border-radius:6px}
      /* modal/backdrop styles (ensure publish modal centers correctly) */
      .modal-backdrop{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(2,6,23,0.45);z-index:1200}
      .modal{background:#fff;padding:18px;border-radius:10px;max-width:520px;width:92%;box-shadow:0 10px 30px rgba(2,6,23,0.2);border:1px solid rgba(15,23,42,0.06)}
      .modal h3{margin:0 0 8px;font-size:18px}
      .modal .small{color:#6b7280}
    </style>
</head>
<body>
  <div class="limited-offer-banner">
      <div class="banner-content">
          <i class="fas fa-info-circle"></i>
          <span class="banner-text">Admin: Create Pricebook Item</span>
      </div>
  </div>

  <div class="app-container">
  <!-- Sidebar (same structure as home.html) -->
  <nav class="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <i class="fas fa-store"></i>
          <div class="logo-text-wrapper">
            <span class="logo-text" id="storeName">My Store</span>
            <button class="edit-store-btn" title="Edit store name">
              <i class="fas fa-pencil-alt"></i>
            </button>
          </div>
        </div>
      </div>

      <div class="sidebar-nav">
        <div class="nav-section-label">MAIN</div>
        <a href="../home.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-home"></i><span>Home</span></a>
        <a href="../quotes.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-file-contract"></i><span>Quotes</span></a>
        <a href="../tenant_schedule.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-calendar-alt"></i><span>Schedule</span></a>
        <a href="../manage-team/manage-team.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-users"></i><span>Manage team</span></a>
        <a href="pricebook.html" class="nav-item" style="text-decoration: none; color: inherit;"><i class="fas fa-book"></i><span>My pricebook</span></a>

      <div class="sidebar-footer">
        <div class="nav-item">
          <i class="fas fa-question-circle"></i>
          <span>Get Set Up</span>
        </div>
        <div class="nav-item">
          <i class="fas fa-cog"></i>
          <span>Settings</span>
        </div>
      </div>
    </nav>

    <main class="main-content">
      <header class="top-header">
        <div class="header-left">
          <a href="../home.html" style="text-decoration:none;color:inherit;"><button class="back-btn"><i class="fas fa-arrow-left"></i></button></a>
          <h1 class="page-title">Create Pricebook Item</h1>
        </div>
        <div class="header-right">
          <button class="discard-btn">Discard</button>
          <button class="status-toggle-btn" id="statusToggleBtn"><i class="fas fa-toggle-off"></i> Draft</button>
          <button class="save-btn">Save</button>
        </div>
      </header>

      <div class="content-wrapper">
        <div class="left-column">
          <div class="card">
            <div class="title-type-row">
              <div class="form-group title-group">
                <label for="code">Code</label>
                <input id="code" name="code" type="text" class="form-input" placeholder="e.g., CLEAN-001">
              </div>
              <div class="form-group type-group">
                <label for="typeSelect">Type</label>
                <select id="typeSelect" class="form-select">
                  <option value="service">Service</option>
                  <option value="product">Product</option>
                </select>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header"><label class="card-label">Name</label></div>
            <input id="name" type="text" class="form-input" placeholder="Standard Home Cleaning">
          </div>

          <div class="card">
            <div class="card-header"><label class="card-label">Description</label></div>
            <textarea id="description" class="form-textarea" placeholder="Describe the service or product"></textarea>
          </div>

          <div class="card" id="serviceFields">
            <div class="card-header"><label class="card-label">Service details</label></div>
            <div class="form-group">
              <label>Default duration (minutes)</label>
              <input id="duration" type="number" class="form-input" min="0" placeholder="60">
            </div>
            <div class="form-group" style="margin-top:8px">
              <label>Unit</label>
              <select id="unit" class="form-select"><option value="each">each</option><option value="hour">hour</option><option value="sqft">sq ft</option></select>
            </div>
          </div>

          <div class="card" id="productFields" style="display:none">
            <div class="card-header"><label class="card-label">Product details</label></div>
            <div class="form-group">
              <label>SKU</label>
              <input id="sku" type="text" class="form-input" placeholder="SKU-001">
            </div>
            <div class="form-group" style="margin-top:8px">
              <label>Cost</label>
              <div class="price-input-wrapper"><span class="currency-symbol">$</span><input id="cost" type="number" class="form-input" step="0.01" min="0"></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header"><label class="card-label">Pricing</label></div>
            <div class="form-group">
              <label>Base price</label>
              <div class="price-input-wrapper"><span class="currency-symbol">$</span><input id="price" type="number" class="form-input" step="0.01" min="0"></div>
            </div>
            <div class="form-group" style="margin-top:8px">
              <label>Tax category (Australia)</label>
              <select id="tax" class="form-select">
                <option value="taxable_gst">Taxable — GST applies (standard 10%)</option>
                <option value="gst_free">GST-free — 0% (e.g., some health, basic food)</option>
                <option value="input_taxed">Input-taxed — no GST charged but special reporting (e.g., financial supplies, residential rent)</option>
              </select>
            </div>
          </div>

          <div class="card">
            <div class="card-header"><label class="card-label">Tags</label></div>
            <div class="form-group">
              <input id="tagsInput" class="form-input" placeholder="Comma separated tags">
            </div>
          </div>
        </div>

        <div class="right-column">
          <div class="card preview-card">
            <h4 class="card-title">Item preview</h4>
            <div class="preview-image" style="position:relative;width:100%;max-width:400px;margin:auto;">
              <img id="previewImg" src="https://placehold.co/400x250?text=Image" alt="preview" style="width:100%;height:auto;border-radius:6px;cursor:pointer;">
              <input type="file" id="mainImgInput" accept="image/*" style="display:none">
              <div id="mainImgUploadOverlay" style="display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.45);color:#fff;align-items:center;justify-content:center;cursor:pointer;border-radius:6px;z-index:2;font-size:18px;gap:6px;flex-direction:column;">
                <i class="fas fa-upload" style="font-size:28px;"></i>
                <span style="font-size:15px;">Upload</span>
              </div>
            </div>

            <!-- Image + full item Preview Modal -->
            <div id="imgPreviewModal" class="modal-backdrop" style="z-index:1300;display:none;align-items:center;justify-content:center;">
              <div class="modal" style="max-width:960px;width:94%;display:flex;gap:18px;align-items:flex-start;">
                <div style="flex:1;min-width:280px;">
                  <img id="imgPreviewLarge" src="" alt="Preview" style="width:100%;height:auto;border-radius:8px;object-fit:cover;max-height:72vh;display:block;background:#fff;">
                </div>
                <div style="flex:1;min-width:260px;max-height:72vh;overflow:auto;padding-right:6px;">
                  <button id="closeImgPreview" style="float:right;background:transparent;border:none;color:#374151;font-size:20px;cursor:pointer;margin-bottom:6px;"><i class="fas fa-times"></i></button>
                  <h3 id="modalTitleName" style="margin-top:6px;margin-bottom:6px">Item name</h3>
                  <div id="modalPrice" style="font-weight:700;color:#1e40af;margin-bottom:8px">$0.00</div>
                  <div id="modalDescription" class="small" style="color:#374151;margin-bottom:12px"></div>
                  <div id="modalExtraDetails" style="color:#374151;font-size:14px;line-height:1.4;margin-bottom:12px"></div>
                  <div style="margin-top:6px;color:#374151;font-size:13px;line-height:1.4">
                    <div><strong>Code:</strong> <span id="modalCode">—</span></div>
                    <div><strong>Tax:</strong> <span id="modalTax">—</span></div>
                    <div><strong>Status:</strong> <span id="modalStatus">Draft</span></div>
                  </div>
                  <div id="modalTags" style="margin-top:10px;display:flex;flex-wrap:wrap;gap:6px"></div>
                  <div style="margin-top:14px"><button class="btn-primary" id="modalCloseBtn">Close</button></div>
                </div>
              </div>
            </div>
            <div class="preview-details">
              <h5 id="previewName" class="preview-name">Item name</h5>
              <p id="previewPrice" class="preview-price">$0.00</p>
              <div class="preview-actions"><button class="btn-secondary" id="openImgPreviewBtn">Preview</button> <button class="btn-primary" id="publishBtn">Publish</button></div>
            </div>
          </div>

          <div class="card">
            <div class="card-header"><label class="card-label">Status & Version</label></div>
            <div class="meta">Status: <strong id="statusLabel">Draft</strong></div>
            <div class="meta" style="margin-top:8px">Version: <strong id="versionLabel">—</strong></div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <div id="publishModal" class="modal-backdrop" role="dialog" aria-modal="true">
    <div class="modal" role="document">
      <h3>Publish Item</h3>
      <p class="small">Publishing will create a new version and make the item available to franchisees. Optionally notify franchisees now.</p>
      <div style="margin-top:12px"><label class="inline"><input type="checkbox" id="notifyFranchisees" checked> Notify franchisees</label></div>
      <div style="margin-top:18px; margin-bottom:10px">
        <label style="font-weight:500;display:block;margin-bottom:6px">Update preview image</label>
        <div style="display:flex;align-items:center;gap:12px">
          <div class="img-upload-hover" style="position:relative;width:120px;height:80px;">
            <img id="modalPreviewImg" src="https://placehold.co/120x80?text=Image" alt="preview" style="width:120px;height:80px;object-fit:cover;border-radius:5px;border:1px solid #e5e7eb;">
            <input type="file" id="modalImgInput" accept="image/*" style="display:none">
            <div id="imgUploadOverlay" style="display:none;position:absolute;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.45);color:#fff;align-items:center;justify-content:center;cursor:pointer;border-radius:5px;z-index:2;font-size:15px;gap:6px;flex-direction:column;">
              <i class="fas fa-upload" style="font-size:22px;"></i>
              <span style="font-size:13px;">Upload</span>
            </div>
          </div>
        </div>
      </div>
      <div class="actions" style="margin-top:16px"><button class="btn-ghost" id="cancelPublish">Cancel</button><button class="btn-primary" id="confirmPublish">Confirm & Publish</button></div>
    </div>
  </div>

  <script src="../add-product-script.js"></script>
  <script>
    // reuse simple behaviors: toggle product/service fields and update preview
    const typeSelect = document.getElementById('typeSelect');
    const serviceFields = document.getElementById('serviceFields');
    const productFields = document.getElementById('productFields');
    const nameInput = document.getElementById('name');
    const priceInput = document.getElementById('price');
    const previewName = document.getElementById('previewName');
    const previewPrice = document.getElementById('previewPrice');
    const previewImg = document.getElementById('previewImg');
    const publishBtn = document.getElementById('publishBtn');
    const publishModal = document.getElementById('publishModal');
    const cancelPublish = document.getElementById('cancelPublish');
    const confirmPublish = document.getElementById('confirmPublish');
  // Main preview image upload (hover)
    // Image preview modal logic
    const imgPreviewModal = document.getElementById('imgPreviewModal');
    const imgPreviewLarge = document.getElementById('imgPreviewLarge');
    const closeImgPreview = document.getElementById('closeImgPreview');

    previewImg.addEventListener('click', () => {
      openFullPreview();
    });
    closeImgPreview.addEventListener('click', () => {
      imgPreviewModal.style.display = 'none';
    });
    imgPreviewModal.addEventListener('click', (e) => {
      if (e.target === imgPreviewModal) {
        imgPreviewModal.style.display = 'none';
      }
    });
    // Preview button opens full item preview modal
    const openImgPreviewBtn = document.getElementById('openImgPreviewBtn');
    openImgPreviewBtn.addEventListener('click', () => openFullPreview());

    function openFullPreview() {
      // populate image and fields
      imgPreviewLarge.src = previewImg.src;
      document.getElementById('modalTitleName').textContent = nameInput.value || 'Item name';
  document.getElementById('modalPrice').textContent = priceInput.value ? `$${Number(priceInput.value).toFixed(2)}` : '$0.00';
  document.getElementById('modalDescription').textContent = document.getElementById('description').value || '';

      // code, tax, status, version
      document.getElementById('modalCode').textContent = document.getElementById('code').value || '—';
      const taxSelect = document.getElementById('tax');
      document.getElementById('modalTax').textContent = taxSelect.options[taxSelect.selectedIndex].text || '—';
      document.getElementById('modalStatus').textContent = document.getElementById('statusLabel').textContent || 'Draft';
  // version removed by request

      // extra details
      const extra = [];
      if (typeSelect.value === 'service') {
        const dur = document.getElementById('duration').value;
        const unit = document.getElementById('unit').value;
        if (dur) extra.push(`Duration: ${dur} ${unit}`);
      } else {
        const sku = document.getElementById('sku').value;
        const cost = document.getElementById('cost').value;
        if (sku) extra.push(`SKU: ${sku}`);
        if (cost) extra.push(`Cost: $${Number(cost).toFixed(2)}`);
      }
      document.getElementById('modalExtraDetails').textContent = extra.join(' • ');

      // tags
      const tagsContainer = document.getElementById('tagsContainer');
      const modalTags = document.getElementById('modalTags');
      modalTags.innerHTML = '';
      if (tagsContainer) {
        const tagEls = Array.from(tagsContainer.querySelectorAll('.tag'));
        tagEls.forEach(t => {
          const span = document.createElement('span');
          span.className = 'tag';
          span.textContent = t.textContent.trim();
          span.style.marginRight = '6px';
          modalTags.appendChild(span);
        });
      }

      imgPreviewModal.style.display = 'flex';
    }
    const mainImgInput = document.getElementById('mainImgInput');
    const mainImgUploadOverlay = document.getElementById('mainImgUploadOverlay');
    const previewImageDiv = document.querySelector('.preview-image');

    previewImageDiv.addEventListener('mouseenter', () => {
      mainImgUploadOverlay.style.display = 'flex';
    });
    previewImageDiv.addEventListener('mouseleave', () => {
      mainImgUploadOverlay.style.display = 'none';
    });
    mainImgUploadOverlay.addEventListener('click', () => {
      mainImgInput.click();
    });
    mainImgInput.addEventListener('change', function() {
      const file = this.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          previewImg.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
      // reset input so same file can be reselected
      this.value = '';
    });
  const modalImgInput = document.getElementById('modalImgInput');
  const modalPreviewImg = document.getElementById('modalPreviewImg');
  const imgUploadOverlay = document.getElementById('imgUploadOverlay');
  const imgUploadHover = modalPreviewImg.parentElement;

    // Sync modal preview image with main preview
    function syncModalPreviewImg() {
      modalPreviewImg.src = previewImg.src;
    }

    typeSelect.addEventListener('change', ()=>{
      if(typeSelect.value==='product'){ productFields.style.display='block'; serviceFields.style.display='none'; }
      else { productFields.style.display='none'; serviceFields.style.display='block'; }
    });

    nameInput.addEventListener('input', ()=> previewName.textContent = nameInput.value || 'Item name');
    priceInput.addEventListener('input', ()=> previewPrice.textContent = priceInput.value ? `$${Number(priceInput.value).toFixed(2)}` : '$0.00');

    publishBtn.addEventListener('click', ()=> {
      syncModalPreviewImg();
      publishModal.style.display='flex';
    });
    cancelPublish.addEventListener('click', ()=> publishModal.style.display='none');
    confirmPublish.addEventListener('click', ()=>{
      // When publishing, update main preview image if changed in modal
      if (modalPreviewImg.src !== previewImg.src) {
        previewImg.src = modalPreviewImg.src;
      }
      publishModal.style.display='none';
      alert('Published (demo)');
    });

    // Hover overlay logic
    imgUploadHover.addEventListener('mouseenter', () => {
      imgUploadOverlay.style.display = 'flex';
    });
    imgUploadHover.addEventListener('mouseleave', () => {
      imgUploadOverlay.style.display = 'none';
    });
    imgUploadOverlay.addEventListener('click', () => {
      modalImgInput.click();
    });
    modalImgInput.addEventListener('change', function() {
      const file = this.files[0];
      if (file && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(e) {
          modalPreviewImg.src = e.target.result;
        };
        reader.readAsDataURL(file);
      }
      // reset input so same file can be reselected
      this.value = '';
    });
  </script>
</body>
</html>